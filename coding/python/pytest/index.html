<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="My second brain"><link href=https://lyz-code.github.io/blue-book/coding/python/pytest/ rel=canonical><meta name=author content=Lyz><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.1, mkdocs-material-4.6.3"><title>Python pytest</title><link rel=stylesheet href=../../../assets/stylesheets/application.adb8469c.css><link rel=stylesheet href=../../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content=#546e7a><script src=../../../assets/javascripts/modernizr.86422ebf.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../../assets/fonts/material-icons.css><link rel=stylesheet href=../../../stylesheets/extra.css><link rel=stylesheet href=../../../stylesheets/links.css></head> <body dir=ltr data-md-color-primary=blue-grey data-md-color-accent=light-blue> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#install tabindex=0 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://lyz-code.github.io/blue-book title="The Blue Book" aria-label="The Blue Book" class="md-header-nav__button md-logo"> <img alt=logo src=../../../images/logo.bmp width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> The Blue Book </span> <span class=md-header-nav__topic> Python pytest </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input aria-label=search name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/lyz-code/blue-book/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> lyz-code/blue-book </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://lyz-code.github.io/blue-book title="The Blue Book" class="md-nav__button md-logo"> <img alt=logo src=../../../images/logo.bmp width=48 height=48> </a> The Blue Book </label> <div class=md-nav__source> <a href=https://github.com/lyz-code/blue-book/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> lyz-code/blue-book </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. title=Introduction class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Meta </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Meta </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../meta/meta/ title=Meta class=md-nav__link> Meta </a> </li> <li class=md-nav__item> <a href=../../../projects/projects/ title=Projects class=md-nav__link> Projects </a> </li> <li class=md-nav__item> <a href=../../../wish_list/ title="Wish list" class=md-nav__link> Wish list </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> DevOps </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> DevOps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../devops/devops/ title=DevOps class=md-nav__link> DevOps </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-2 type=checkbox id=nav-3-2> <label class=md-nav__link for=nav-3-2> Kubernetes </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-2> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../devops/kubernetes/kubernetes/ title=Kubernetes class=md-nav__link> Kubernetes </a> </li> <li class=md-nav__item> <a href=../../../devops/kubernetes/kubernetes_architecture/ title=Architecture class=md-nav__link> Architecture </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-2-3 type=checkbox id=nav-3-2-3> <label class=md-nav__link for=nav-3-2-3> Resources </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-3-2-3> Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../devops/kubernetes/kubernetes_namespaces/ title=Namespaces class=md-nav__link> Namespaces </a> </li> <li class=md-nav__item> <a href=../../../devops/kubernetes/kubernetes_pods/ title=Pods class=md-nav__link> Pods </a> </li> <li class=md-nav__item> <a href=../../../devops/kubernetes/kubernetes_replicasets/ title=ReplicaSets class=md-nav__link> ReplicaSets </a> </li> <li class=md-nav__item> <a href=../../../devops/kubernetes/kubernetes_deployments/ title=Deployments class=md-nav__link> Deployments </a> </li> <li class=md-nav__item> <a href=../../../devops/kubernetes/kubernetes_hpa/ title="Horizontal Pod Autoscaling" class=md-nav__link> Horizontal Pod Autoscaling </a> </li> <li class=md-nav__item> <a href=../../../devops/kubernetes/kubernetes_volumes/ title=Volumes class=md-nav__link> Volumes </a> </li> <li class=md-nav__item> <a href=../../../devops/kubernetes/kubernetes_services/ title=Services class=md-nav__link> Services </a> </li> <li class=md-nav__item> <a href=../../../devops/kubernetes/kubernetes_labels/ title=Labels class=md-nav__link> Labels </a> </li> <li class=md-nav__item> <a href=../../../devops/kubernetes/kubernetes_annotations/ title=Annotations class=md-nav__link> Annotations </a> </li> <li class=md-nav__item> <a href=../../../devops/kubernetes/kubernetes_ingress/ title=Ingress class=md-nav__link> Ingress </a> </li> <li class=md-nav__item> <a href=../../../devops/kubernetes/kubernetes_operators/ title=Operators class=md-nav__link> Operators </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-2-4 type=checkbox id=nav-3-2-4> <label class=md-nav__link for=nav-3-2-4> Kubectl </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-3-2-4> Kubectl </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../devops/kubectl/kubectl/ title=Kubectl class=md-nav__link> Kubectl </a> </li> <li class=md-nav__item> <a href=../../../devops/kubectl/kubectl_installation/ title="Kubectl Installation" class=md-nav__link> Kubectl Installation </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-2-5 type=checkbox id=nav-3-2-5> <label class=md-nav__link for=nav-3-2-5> Additional Components </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-3-2-5> Additional Components </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../devops/kubernetes/kubernetes_metric_server/ title="Metrics Server" class=md-nav__link> Metrics Server </a> </li> <li class=md-nav__item> <a href=../../../devops/kubernetes/kubernetes_ingress_controller/ title="Ingress Controller" class=md-nav__link> Ingress Controller </a> </li> <li class=md-nav__item> <a href=../../../devops/kubernetes/kubernetes_external_dns/ title="External DNS" class=md-nav__link> External DNS </a> </li> <li class=md-nav__item> <a href=../../../devops/kubernetes/kubernetes_cluster_autoscaler/ title="Cluster Autoscaler" class=md-nav__link> Cluster Autoscaler </a> </li> <li class=md-nav__item> <a href=../../../devops/kubernetes/kubernetes_dashboard/ title=Dashboard class=md-nav__link> Dashboard </a> </li> <li class=md-nav__item> <a href=../../../devops/kubernetes/kubernetes_storage_driver/ title="Storage Driver" class=md-nav__link> Storage Driver </a> </li> <li class=md-nav__item> <a href=../../../devops/kubernetes/kubernetes_vertical_pod_autoscaler/ title="Vertical Pod Autoscaler" class=md-nav__link> Vertical Pod Autoscaler </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../devops/kubernetes/kubernetes_networking/ title=Networking class=md-nav__link> Networking </a> </li> <li class=md-nav__item> <a href=../../../devops/kubernetes/kubernetes_tools/ title=Tools class=md-nav__link> Tools </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-3 type=checkbox id=nav-3-3> <label class=md-nav__link for=nav-3-3> Helm </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-3> Helm </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../devops/helm/helm/ title=Helm class=md-nav__link> Helm </a> </li> <li class=md-nav__item> <a href=../../../devops/helm/helm_installation/ title="Helm Installation" class=md-nav__link> Helm Installation </a> </li> <li class=md-nav__item> <a href=../../../devops/helm/helm_commands/ title="Helm Commands" class=md-nav__link> Helm Commands </a> </li> <li class=md-nav__item> <a href=../../../devops/helm/helm_secrets/ title="Helm Secrets" class=md-nav__link> Helm Secrets </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../devops/helmfile/ title=Helmfile class=md-nav__link> Helmfile </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-5 type=checkbox id=nav-3-5> <label class=md-nav__link for=nav-3-5> Prometheus </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-5> Prometheus </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../devops/prometheus/prometheus/ title=Prometheus class=md-nav__link> Prometheus </a> </li> <li class=md-nav__item> <a href=../../../devops/prometheus/prometheus_architecture/ title=Architecture class=md-nav__link> Architecture </a> </li> <li class=md-nav__item> <a href=../../../devops/prometheus/prometheus_operator/ title="Prometheus Operator" class=md-nav__link> Prometheus Operator </a> </li> <li class=md-nav__item> <a href=../../../devops/prometheus/prometheus_installation/ title="Prometheus Install" class=md-nav__link> Prometheus Install </a> </li> <li class=md-nav__item> <a href=../../../devops/prometheus/alertmanager/ title=AlertManager class=md-nav__link> AlertManager </a> </li> <li class=md-nav__item> <a href=../../../devops/prometheus/blackbox_exporter/ title="Blackbox Exporter" class=md-nav__link> Blackbox Exporter </a> </li> <li class=md-nav__item> <a href=../../../devops/prometheus/node_exporter/ title="Node Exporter" class=md-nav__link> Node Exporter </a> </li> <li class=md-nav__item> <a href=../../../devops/prometheus/prometheus_troubleshooting/ title="Prometheus Troubleshooting" class=md-nav__link> Prometheus Troubleshooting </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-6 type=checkbox id=nav-3-6> <label class=md-nav__link for=nav-3-6> Linux </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-6> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/brew/ title=brew class=md-nav__link> brew </a> </li> <li class=md-nav__item> <a href=../../../linux/cookiecutter/ title=cookiecutter class=md-nav__link> cookiecutter </a> </li> <li class=md-nav__item> <a href=../../../linux/fail2ban/ title=fail2ban class=md-nav__link> fail2ban </a> </li> <li class=md-nav__item> <a href=../../../linux/google_chrome/ title="google chrome" class=md-nav__link> google chrome </a> </li> <li class=md-nav__item> <a href=../../../linux/hypothesis/ title=hypothesis class=md-nav__link> hypothesis </a> </li> <li class=md-nav__item> <a href=../../../linux/luks/luks/ title=LUKS class=md-nav__link> LUKS </a> </li> <li class=md-nav__item> <a href=../../../linux/mkdocs/ title=mkdocs class=md-nav__link> mkdocs </a> </li> <li class=md-nav__item> <a href=../../../linux/monica/ title=monica class=md-nav__link> monica </a> </li> <li class=md-nav__item> <a href=../../../linux/linux_miscellaneous/ title="Miscellaneous Linux Commands" class=md-nav__link> Miscellaneous Linux Commands </a> </li> <li class=md-nav__item> <a href=../../../linux/nodejs/ title=nodejs class=md-nav__link> nodejs </a> </li> <li class=md-nav__item> <a href=../../../linux/rm/ title=rm class=md-nav__link> rm </a> </li> <li class=md-nav__item> <a href=../../../linux/syncthing/ title=Syncthing class=md-nav__link> Syncthing </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-6-13 type=checkbox id=nav-3-6-13> <label class=md-nav__link for=nav-3-6-13> Vim </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-3-6-13> Vim </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/vim/vim_plugins/ title="Vim Plugins" class=md-nav__link> Vim Plugins </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../linux/zip/ title=zip class=md-nav__link> zip </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-7 type=checkbox id=nav-3-7> <label class=md-nav__link for=nav-3-7> AWS </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-7> AWS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../devops/aws/aws/ title=AWS class=md-nav__link> AWS </a> </li> <li class=md-nav__item> <a href=../../../devops/aws/security_groups/ title="Security groups workflow" class=md-nav__link> Security groups workflow </a> </li> <li class=md-nav__item> <a href=../../../devops/aws/eks/ title=EKS class=md-nav__link> EKS </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-7-4 type=checkbox id=nav-3-7-4> <label class=md-nav__link for=nav-3-7-4> IAM </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-3-7-4> IAM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../devops/aws/iam/iam/ title=IAM class=md-nav__link> IAM </a> </li> <li class=md-nav__item> <a href=../../../devops/aws/iam/iam_commands/ title="IAM Commands" class=md-nav__link> IAM Commands </a> </li> <li class=md-nav__item> <a href=../../../devops/aws/iam/iam_debug/ title="IAM Debugging" class=md-nav__link> IAM Debugging </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../devops/aws/s3/ title=S3 class=md-nav__link> S3 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-8 type=checkbox id=nav-3-8> <label class=md-nav__link for=nav-3-8> API Management </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-8> API Management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../devops/api_management/ title="API Management" class=md-nav__link> API Management </a> </li> <li class=md-nav__item> <a href=../../../devops/kong/kong/ title=Kong class=md-nav__link> Kong </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4 checked> <label class=md-nav__link for=nav-4> Coding </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> Coding </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tdd/ title=TDD class=md-nav__link> TDD </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-2 type=checkbox id=nav-4-2 checked> <label class=md-nav__link for=nav-4-2> Python </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-2> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-2-1 type=checkbox id=nav-4-2-1> <label class=md-nav__link for=nav-4-2-1> Project Template </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-4-2-1> Project Template </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../python_project_template/ title="Project Template" class=md-nav__link> Project Template </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-2-1-2 type=checkbox id=nav-4-2-1-2> <label class=md-nav__link for=nav-4-2-1-2> Command-line Project Template </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-4-2-1-2> Command-line Project Template </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../python_project_template/python_cli_template/ title="Command-line Project Template" class=md-nav__link> Command-line Project Template </a> </li> <li class=md-nav__item> <a href=../python_project_template/python_sqlalchemy_without_flask/ title="Configure SQLAlchemy for projects without flask" class=md-nav__link> Configure SQLAlchemy for projects without flask </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../python_project_template/python_flask_template/ title="Flask Project Template" class=md-nav__link> Flask Project Template </a> </li> <li class=md-nav__item> <a href=../python_project_template/python_microservices_template/ title="Microservices Project Template" class=md-nav__link> Microservices Project Template </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-2-1-5 type=checkbox id=nav-4-2-1-5> <label class=md-nav__link for=nav-4-2-1-5> Common configurations </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-4-2-1-5> Common configurations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../python_project_template/python_docs/ title="Create the documentation repository" class=md-nav__link> Create the documentation repository </a> </li> <li class=md-nav__item> <a href=../python_ci/ title="Continuous integration pipelines" class=md-nav__link> Continuous integration pipelines </a> </li> <li class=md-nav__item> <a href=../python_config_yaml/ title="Load config from YAML" class=md-nav__link> Load config from YAML </a> </li> <li class=md-nav__item> <a href=../python_project_template/python_sqlalchemy_mariadb/ title="Configure SQLAlchemy to use the MariaDB/Mysql backend" class=md-nav__link> Configure SQLAlchemy to use the MariaDB/Mysql backend </a> </li> <li class=md-nav__item> <a href=../python_project_template/python_docker/ title="Configure Docker to host the application" class=md-nav__link> Configure Docker to host the application </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-2-2 type=checkbox id=nav-4-2-2> <label class=md-nav__link for=nav-4-2-2> Libraries </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-4-2-2> Libraries </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../alembic/ title=Alembic class=md-nav__link> Alembic </a> </li> <li class=md-nav__item> <a href=../click/ title=Click class=md-nav__link> Click </a> </li> <li class=md-nav__item> <a href=../factoryboy/ title=FactoryBoy class=md-nav__link> FactoryBoy </a> </li> <li class=md-nav__item> <a href=../faker/ title=Faker class=md-nav__link> Faker </a> </li> <li class=md-nav__item> <a href=../flask/ title=Flask class=md-nav__link> Flask </a> </li> <li class=md-nav__item> <a href=../folium/ title=Folium class=md-nav__link> Folium </a> </li> <li class=md-nav__item> <a href=../feedparser/ title=Feedparser class=md-nav__link> Feedparser </a> </li> <li class=md-nav__item> <a href=../pandas/ title=Pandas class=md-nav__link> Pandas </a> </li> <li class=md-nav__item> <a href=../plotly/ title=Plotly class=md-nav__link> Plotly </a> </li> <li class=md-nav__item> <a href=../ruamel_yaml/ title="Ruamel YAML" class=md-nav__link> Ruamel YAML </a> </li> <li class=md-nav__item> <a href=../sqlalchemy/ title=SQLAlchemy class=md-nav__link> SQLAlchemy </a> </li> <li class=md-nav__item> <a href=../redis-py/ title=Redis-py class=md-nav__link> Redis-py </a> </li> <li class=md-nav__item> <a href=../requests_mock/ title=Requests-mock class=md-nav__link> Requests-mock </a> </li> <li class=md-nav__item> <a href=../rq/ title=Rq class=md-nav__link> Rq </a> </li> <li class=md-nav__item> <a href=../sh/ title=sh class=md-nav__link> sh </a> </li> <li class=md-nav__item> <a href=../tinydb/ title=TinyDB class=md-nav__link> TinyDB </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../python_code_styling/ title="Code Styling" class=md-nav__link> Code Styling </a> </li> <li class=md-nav__item> <a href=../python_anti_patterns/ title=Anti-Patterns class=md-nav__link> Anti-Patterns </a> </li> <li class=md-nav__item> <a href=../data_classes/ title="Data Classes" class=md-nav__link> Data Classes </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Pytest </label> <a href=./ title=Pytest class="md-nav__link md-nav__link--active"> Pytest </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#install class=md-nav__link> Install </a> </li> <li class=md-nav__item> <a href=#usage class=md-nav__link> Usage </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#parametrized-testing class=md-nav__link> Parametrized testing </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#parametrize-fixture-arguments class=md-nav__link> Parametrize fixture arguments </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fixtures class=md-nav__link> Fixtures </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#sharing-fixtures-through-conftestpy class=md-nav__link> Sharing fixtures through conftest.py </a> </li> <li class=md-nav__item> <a href=#specifying-fixture-scope class=md-nav__link> Specifying fixture scope </a> </li> <li class=md-nav__item> <a href=#builtin-fixtures class=md-nav__link> Builtin Fixtures </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#the-tmpdir-fixture class=md-nav__link> The tmpdir fixture </a> </li> <li class=md-nav__item> <a href=#the-caplog-fixture class=md-nav__link> The caplog fixture </a> </li> <li class=md-nav__item> <a href=#the-capsys-fixture class=md-nav__link> The capsys fixture </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#use-a-fixture-more-than-once-in-a-function class=md-nav__link> Use a fixture more than once in a function </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#snippets class=md-nav__link> Snippets </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mocking-sysexit class=md-nav__link> Mocking sys.exit </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#pytest-integration-with-vim class=md-nav__link> pytest integration with Vim </a> </li> <li class=md-nav__item> <a href=#reference class=md-nav__link> Reference </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-3 type=checkbox id=nav-4-3> <label class=md-nav__link for=nav-4-3> Javascript </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-3> Javascript </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../javascript/javascript/ title=Javascript class=md-nav__link> Javascript </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../json/json/ title=JSON class=md-nav__link> JSON </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-5 type=checkbox id=nav-4-5> <label class=md-nav__link for=nav-4-5> React </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-5> React </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../react/react/ title=React class=md-nav__link> React </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../yaml/yaml/ title=YAML class=md-nav__link> YAML </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Software Architecture </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Software Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../architecture/solid/ title=SOLID class=md-nav__link> SOLID </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> Domain Driven Design </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-2> Domain Driven Design </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../architecture/domain_driven_design/ title="Domain Driven Design" class=md-nav__link> Domain Driven Design </a> </li> <li class=md-nav__item> <a href=../../../architecture/repository_pattern/ title="Repository Pattern" class=md-nav__link> Repository Pattern </a> </li> <li class=md-nav__item> <a href=../../../architecture/service_layer_pattern/ title="Service Layer Pattern" class=md-nav__link> Service Layer Pattern </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../architecture/database_architecture/ title="Database Architecture" class=md-nav__link> Database Architecture </a> </li> <li class=md-nav__item> <a href=../../../architecture/microservices/ title=Microservices class=md-nav__link> Microservices </a> </li> <li class=md-nav__item> <a href=../../../architecture/restful_apis/ title="Restful APIS" class=md-nav__link> Restful APIS </a> </li> <li class=md-nav__item> <a href=../../../architecture/redis/ title=Redis class=md-nav__link> Redis </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> Data Analysis </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-6> Data Analysis </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-1 type=checkbox id=nav-6-1> <label class=md-nav__link for=nav-6-1> Recommender Systems </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-1> Recommender Systems </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../data_analysis/recommender_systems/recommender_systems/ title="Recommender Systems" class=md-nav__link> Recommender Systems </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class=md-nav__link for=nav-7> Life Automation </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-7> Life Automation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../life_automation/life_automation/ title="Life Automation" class=md-nav__link> Life Automation </a> </li> <li class=md-nav__item> <a href=../../../life_automation/week_automation/ title="Week Automation" class=md-nav__link> Week Automation </a> </li> <li class=md-nav__item> <a href=../../../life_automation/relationship_automation/ title="Relationship Automation" class=md-nav__link> Relationship Automation </a> </li> <li class=md-nav__item> <a href=../../../life_automation/vim_automation/ title="Vim Automation" class=md-nav__link> Vim Automation </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8 type=checkbox id=nav-8> <label class=md-nav__link for=nav-8> Arts </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-8> Arts </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1 type=checkbox id=nav-8-1> <label class=md-nav__link for=nav-8-1> Writing </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-1> Writing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../writing/orthography/ title="English Grammar and Ortography" class=md-nav__link> English Grammar and Ortography </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2 type=checkbox id=nav-8-2> <label class=md-nav__link for=nav-8-2> Dancing </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-2> Dancing </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2-1 type=checkbox id=nav-8-2-1> <label class=md-nav__link for=nav-8-2-1> Rave Dances </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-2-1> Rave Dances </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../dancing/rave_dances/ title="Rave Dances" class=md-nav__link> Rave Dances </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2-1-2 type=checkbox id=nav-8-2-1-2> <label class=md-nav__link for=nav-8-2-1-2> Shuffle </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-8-2-1-2> Shuffle </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../dancing/shuffle_basics/ title=Basics class=md-nav__link> Basics </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-3 type=checkbox id=nav-8-3> <label class=md-nav__link for=nav-8-3> Drawing </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-3> Drawing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../drawing/drawing/ title=Drawing class=md-nav__link> Drawing </a> </li> <li class=md-nav__item> <a href=../../../drawing/exercise_pool/ title="Exercise Pool" class=md-nav__link> Exercise Pool </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-9 type=checkbox id=nav-9> <label class=md-nav__link for=nav-9> Psychology </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-9> Psychology </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../psychology/the_xy_problem/ title="The XY Problem" class=md-nav__link> The XY Problem </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../emojis/ title=Emojis class=md-nav__link> Emojis </a> </li> <li class=md-nav__item> <a href=../../../contact/ title=Contact class=md-nav__link> Contact </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#install class=md-nav__link> Install </a> </li> <li class=md-nav__item> <a href=#usage class=md-nav__link> Usage </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#parametrized-testing class=md-nav__link> Parametrized testing </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#parametrize-fixture-arguments class=md-nav__link> Parametrize fixture arguments </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fixtures class=md-nav__link> Fixtures </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#sharing-fixtures-through-conftestpy class=md-nav__link> Sharing fixtures through conftest.py </a> </li> <li class=md-nav__item> <a href=#specifying-fixture-scope class=md-nav__link> Specifying fixture scope </a> </li> <li class=md-nav__item> <a href=#builtin-fixtures class=md-nav__link> Builtin Fixtures </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#the-tmpdir-fixture class=md-nav__link> The tmpdir fixture </a> </li> <li class=md-nav__item> <a href=#the-caplog-fixture class=md-nav__link> The caplog fixture </a> </li> <li class=md-nav__item> <a href=#the-capsys-fixture class=md-nav__link> The capsys fixture </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#use-a-fixture-more-than-once-in-a-function class=md-nav__link> Use a fixture more than once in a function </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#snippets class=md-nav__link> Snippets </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mocking-sysexit class=md-nav__link> Mocking sys.exit </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#pytest-integration-with-vim class=md-nav__link> pytest integration with Vim </a> </li> <li class=md-nav__item> <a href=#reference class=md-nav__link> Reference </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/lyz-code/blue-book/edit/master/docs/coding/python/pytest.md title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a> <h1>Pytest</h1> <p><a href=https://docs.pytest.org/en/latest>pytest</a> is a Python framework to makes it easy to write small tests, yet scales to support complex functional testing for applications and libraries.</p> <p>Pytest stands out over other test frameworks in:</p> <ul> <li>Simple tests are simple to write in pytest.</li> <li>Complex tests are still simple to write.</li> <li>Tests are easy to read.</li> <li>You can get started in seconds.</li> <li>You use <code>assert</code> to fail a test, not things like <code>self.assertEqual()</code> or <code>self.assertLessThan()</code>. Just <code>assert</code>.</li> <li>You can use pytest to run tests written for unittest or nose.</li> </ul> <h2 id=install>Install<a class=headerlink href=#install title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code>pip install pytest
</code></pre></div> <h2 id=usage>Usage<a class=headerlink href=#usage title="Permanent link">&para;</a></h2> <p>Run in the project directory.</p> <div class=highlight><pre><span></span><code>pytest
</code></pre></div> <p>If you need more information run it with <code>-v</code>.</p> <p>Pytest automatically finds which tests to run in a phase called <em>test discovery</em>. It will get the tests that match one of the following conditions:</p> <ul> <li>Test files that are named <code>test_{{ something }}.py</code> or <code>{{ something }}_test.py</code>.</li> <li>Test methods and functions named <code>test_{{ something }}</code>.</li> <li>Test classes named <code>Test{{ Something }}</code>.</li> </ul> <p>There are several possible outcomes of a test function:</p> <ul> <li><em>PASSED (.)</em>: The test ran successfully.</li> <li><em>FAILED (F)</em>: The test did not run usccessfully (or <em>XPASS</em> + strict).</li> <li><em>SKIPPED (s)</em>: The test was skipped. You can tell pytest to skip a test by using enter the <code>@pytest.mark.skip()</code> or <code>pytest.mark.skipif()</code> decorators.</li> <li><em>xfail (x)</em>: The test was not supposed to pass, ran, and failed. You can tell pytest that a test is expected to fail by using the <code>@pytest.mark.xfail()</code> decorator.</li> <li><em>XPASS (X)</em>: The tests was not supposed to pass, ran, and passed.</li> <li><em>ERROR (E)</em>: An exception happened outside of the test function, in either a fixture or a hook function.</li> </ul> <p>Pytest supports several cool flags like:</p> <ul> <li><code>-k EXPRESSION</code>: Used to select a subset of tests to run. For example <code>pytest -k "asdict or defaults"</code> will run both <code>test_asdict()</code> and <code>test_defaults()</code>.</li> <li><code>--lf</code> or <code>--last-failed</code>: Just run the tests that have failed in the previous run.</li> <li><code>-x</code>, or <code>--exitfirst</code>: Exit on first failed test.</li> <li><code>-l</code> or <code>--showlocals</code>: Print out the local variables in a test if the test fails.</li> <li><code>-s</code> Allows any output that normally would be printed to <code>stdout</code> to actually be printed to <code>stdout</code>. It's an alias of <code>--capture=no</code>, so the output is not captured when the tests are run, which is the default behavior. This is useful to debug with <code>print()</code> statements.</li> <li><code>--durations=N</code>: It reports the slowest <code>N</code> number of tests/setups/teardowns after the test run. If you pass in <code>--durations=0</code>, it reports everything in order of slowest to fastest.</li> </ul> <h3 id=parametrized-testing>Parametrized testing<a class=headerlink href=#parametrized-testing title="Permanent link">&para;</a></h3> <p>Parametrized testing is a way to send multiple sets of data through the same test and have pytest report if any of the sets failed.</p> <div class="admonition note"> <p class=admonition-title>File tests/unit/test_func.py</p> <div class=highlight><pre><span></span><code><span class=n>tasks_to_try</span> <span class=o>=</span> <span class=p>(</span>
    <span class=n>Task</span><span class=p>(</span><span class=s1>&#39;sleep&#39;</span><span class=p>,</span> <span class=n>done</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span>
    <span class=n>Task</span><span class=p>(</span><span class=s1>&#39;wake&#39;</span><span class=p>,</span> <span class=s1>&#39;brian&#39;</span><span class=p>),</span>
    <span class=n>Task</span><span class=p>(</span><span class=s1>&#39;wake&#39;</span><span class=p>,</span> <span class=s1>&#39;brian&#39;</span><span class=p>),</span>
    <span class=n>Task</span><span class=p>(</span><span class=s1>&#39;breathe&#39;</span><span class=p>,</span> <span class=s1>&#39;BRIAN&#39;</span><span class=p>,</span> <span class=kc>True</span><span class=p>),</span>
    <span class=n>Task</span><span class=p>(</span><span class=s1>&#39;exercise&#39;</span><span class=p>,</span> <span class=s1>&#39;BrIaN&#39;</span><span class=p>,</span> <span class=kc>False</span><span class=p>),</span>
<span class=p>)</span>

<span class=n>task_ids</span> <span class=o>=</span> <span class=p>[</span>
    <span class=sa>f</span><span class=s1>&#39;Task(</span><span class=si>{</span><span class=n>task</span><span class=o>.</span><span class=n>summary</span><span class=si>}</span><span class=s1>, </span><span class=si>{</span><span class=n>task</span><span class=o>.</span><span class=n>owner</span><span class=si>}</span><span class=s1>, </span><span class=si>{</span><span class=n>task</span><span class=o>.</span><span class=n>done</span><span class=si>}</span><span class=s1>)&#39;</span>
    <span class=k>for</span> <span class=n>task</span> <span class=ow>in</span> <span class=n>tasks_to_try</span>
<span class=p>]</span>

<span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>parametrize</span><span class=p>(</span><span class=s1>&#39;task&#39;</span><span class=p>,</span> <span class=n>tasks_to_try</span><span class=p>,</span> <span class=n>ids</span><span class=o>=</span><span class=n>task_ids</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>test_add_4</span><span class=p>(</span><span class=n>task</span><span class=p>):</span>
    <span class=n>task_id</span> <span class=o>=</span> <span class=n>tasks</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>task</span><span class=p>)</span>
    <span class=n>t_from_db</span> <span class=o>=</span> <span class=n>tasks</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>task_id</span><span class=p>)</span>
    <span class=k>assert</span> <span class=n>equivalent</span><span class=p>(</span><span class=n>t_from_db</span><span class=p>,</span> <span class=n>task</span><span class=p>)</span>
</code></pre></div> </div> <div class=highlight><pre><span></span><code>$ pytest -v test_func.py::test_add_4
<span class=o>=====================</span> <span class=nb>test</span> session <span class=nv>starts</span> <span class=o>======================</span>
collected <span class=m>5</span> items

test_add_variety.py::test_add_4<span class=o>[</span>Task<span class=o>(</span>sleep,None,True<span class=o>)]</span> PASSED
test_add_variety.py::test_add_4<span class=o>[</span>Task<span class=o>(</span>wake,brian,False<span class=o>)</span><span class=m>0</span><span class=o>]</span> PASSED
test_add_variety.py::test_add_4<span class=o>[</span>Task<span class=o>(</span>wake,brian,False<span class=o>)</span><span class=m>1</span><span class=o>]</span> PASSED
test_add_variety.py::test_add_4<span class=o>[</span>Task<span class=o>(</span>breathe,BRIAN,True<span class=o>)]</span> PASSED
test_add_variety.py::test_add_4<span class=o>[</span>Task<span class=o>(</span>exercise,BrIaN,False<span class=o>)]</span> <span class=nv>PASSED</span>

<span class=o>===================</span> <span class=m>5</span> passed in <span class=m>0</span>.04 <span class=nv>seconds</span> <span class=o>===================</span>
</code></pre></div> <p>Those identifiers can be used to run that specific test. For example <code>pytest -v "test_func.py::test_add_4[Task(breathe,BRIAN,True)]"</code>.</p> <p><code>parametrize()</code> can be applied to classes as well.</p> <p>If the test id can't be derived from the parameter value, use the <code>id</code> argument for the <code>pytest.param</code>:</p> <div class=highlight><pre><span></span><code><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>parametrize</span><span class=p>(</span><span class=s1>&#39;task&#39;</span><span class=p>,</span> <span class=p>[</span>
    <span class=n>pytest</span><span class=o>.</span><span class=n>param</span><span class=p>(</span><span class=n>Task</span><span class=p>(</span><span class=s1>&#39;create&#39;</span><span class=p>),</span> <span class=nb>id</span><span class=o>=</span><span class=s1>&#39;just summary&#39;</span><span class=p>),</span>
    <span class=n>pytest</span><span class=o>.</span><span class=n>param</span><span class=p>(</span><span class=n>Task</span><span class=p>(</span><span class=s1>&#39;inspire&#39;</span><span class=p>,</span> <span class=s1>&#39;Michelle&#39;</span><span class=p>),</span> <span class=nb>id</span><span class=o>=</span><span class=s1>&#39;summary/owner&#39;</span><span class=p>),</span>
<span class=p>])</span>
<span class=k>def</span> <span class=nf>test_add_6</span><span class=p>(</span><span class=n>task</span><span class=p>):</span>
    <span class=o>...</span>
</code></pre></div> <p>Will yield:</p> <div class=highlight><pre><span></span><code>$ pytest-v test_add_variety.py::test_add_6

<span class=o>===================</span> <span class=nb>test</span> session <span class=nv>starts</span> <span class=o>====================</span>
collected <span class=m>2</span> items

test_add_variety.py::test_add_6<span class=o>[</span>justsummary<span class=o>]</span>PASSED
test_add_variety.py::test_add_6<span class=o>[</span>summary/owner<span class=o>]</span><span class=nv>PASSED</span>

<span class=o>=================</span> <span class=m>2</span> passed in <span class=m>0</span>.05 <span class=nv>seconds</span> <span class=o>=================</span>
</code></pre></div> <h4 id=parametrize-fixture-arguments><a href=https://docs.pytest.org/en/latest/example/parametrize.html#apply-indirect-on-particular-arguments>Parametrize fixture arguments</a><a class=headerlink href=#parametrize-fixture-arguments title="Permanent link">&para;</a></h4> <p>Sometimes is interesting to parametrize the arguments of a fixture. For example, imagine that we've got two fixtures to generate test data, then when the test is run, it must call the correct fixture for each case.</p> <div class=highlight><pre><span></span><code><span class=nd>@pytest</span><span class=o>.</span><span class=n>fixture</span>
<span class=k>def</span> <span class=nf>insert_task</span><span class=p>():</span>
    <span class=n>task</span> <span class=o>=</span> <span class=n>factories</span><span class=o>.</span><span class=n>TaskFactory</span><span class=o>.</span><span class=n>create</span><span class=p>()</span>

    <span class=n>session</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
        <span class=s1>&#39;INSERT INTO task (id, description, state, type)&#39;</span>
        <span class=s1>&#39;VALUES (&#39;</span>
        <span class=sa>f</span><span class=s1>&#39;&quot;</span><span class=si>{</span><span class=n>task</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s1>&quot;, &quot;</span><span class=si>{</span><span class=n>task</span><span class=o>.</span><span class=n>description</span><span class=si>}</span><span class=s1>&quot;, &quot;</span><span class=si>{</span><span class=n>task</span><span class=o>.</span><span class=n>state</span><span class=si>}</span><span class=s1>&quot;, &quot;task&quot;&#39;</span>
        <span class=s1>&#39;)&#39;</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>task</span>


<span class=nd>@pytest</span><span class=o>.</span><span class=n>fixture</span>
<span class=k>def</span> <span class=nf>insert_project</span><span class=p>(</span><span class=n>session</span><span class=p>):</span>
    <span class=n>project</span> <span class=o>=</span> <span class=n>factories</span><span class=o>.</span><span class=n>ProjectFactory</span><span class=o>.</span><span class=n>create</span><span class=p>()</span>

    <span class=n>session</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
        <span class=s1>&#39;INSERT INTO project (id, description)&#39;</span>
        <span class=sa>f</span><span class=s1>&#39;VALUES (&quot;</span><span class=si>{</span><span class=n>project</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s1>&quot;, &quot;</span><span class=si>{</span><span class=n>project</span><span class=o>.</span><span class=n>description</span><span class=si>}</span><span class=s1>&quot;)&#39;</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>project</span>
</code></pre></div> <p>We can create a fixture that uses both and returns the correct one based on an argument that is given.</p> <div class=highlight><pre><span></span><code><span class=nd>@pytest</span><span class=o>.</span><span class=n>fixture</span>
<span class=k>def</span> <span class=nf>insert_object</span><span class=p>(</span>
    <span class=n>request</span><span class=p>,</span>
    <span class=n>insert_task</span><span class=p>,</span>
    <span class=n>insert_project</span>
<span class=p>):</span>
    <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>param</span> <span class=o>==</span> <span class=s1>&#39;insert_task&#39;</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>insert_task</span>
    <span class=k>elif</span> <span class=n>request</span><span class=o>.</span><span class=n>param</span> <span class=o>==</span> <span class=s1>&#39;insert_project&#39;</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>insert_project</span>

<span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>parametrize</span><span class=p>(</span>
    <span class=s1>&#39;table,insert_object&#39;</span><span class=p>,</span>
    <span class=p>[</span>
        <span class=p>(</span><span class=s1>&#39;task&#39;</span><span class=p>,</span> <span class=s1>&#39;insert_task&#39;</span><span class=p>),</span>
        <span class=p>(</span><span class=s1>&#39;project&#39;</span><span class=p>,</span> <span class=s1>&#39;insert_project&#39;</span><span class=p>),</span>
    <span class=p>]</span>
    <span class=n>models_to_try</span><span class=p>,</span>
    <span class=n>indirect</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;insert_object&#39;</span><span class=p>],</span>
<span class=p>)</span>
<span class=k>def</span> <span class=nf>test_repository_can_retrieve_an_object</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>session</span><span class=p>,</span>
    <span class=n>table</span><span class=p>,</span>
    <span class=n>insert_object</span><span class=p>,</span>
<span class=p>):</span>
    <span class=n>expected_obj</span> <span class=o>=</span> <span class=n>insert_object</span>

    <span class=n>repo</span> <span class=o>=</span> <span class=n>repository</span><span class=o>.</span><span class=n>SqlAlchemyRepository</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>retrieved_obj</span> <span class=o>=</span> <span class=n>repo</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>table</span><span class=p>,</span> <span class=n>expected_obj</span><span class=o>.</span><span class=n>id</span><span class=p>)</span>

    <span class=k>assert</span> <span class=n>retrieved_obj</span> <span class=o>==</span> <span class=n>expected_obj</span>
    <span class=c1># Task.__eq__ only compares reference</span>
    <span class=k>assert</span> <span class=n>retrieved_obj</span><span class=o>.</span><span class=n>description</span> <span class=o>==</span> <span class=n>expected_obj</span><span class=o>.</span><span class=n>description</span>
</code></pre></div> <h2 id=fixtures>Fixtures<a class=headerlink href=#fixtures title="Permanent link">&para;</a></h2> <p>Fixtures are functions that are run by pytest before (and sometimes after) the actual test functions.</p> <p>You can use fixtures to get a data set for the tests to work on, or use them to get a system into a known state before running a test. They are also used to get data ready for multiple tests.</p> <p>Here's a simple fixture that returns a number:</p> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>pytest</span>

<span class=nd>@pytest</span><span class=o>.</span><span class=n>fixture</span><span class=p>()</span>
<span class=k>def</span> <span class=nf>some_data</span><span class=p>()</span>
    <span class=sd>&quot;&quot;&quot; Return answer to the ultimate question &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=mi>42</span>

<span class=k>def</span> <span class=nf>test_some_data</span><span class=p>(</span><span class=n>some_data</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot; Use fixture return value in a test&quot;&quot;&quot;</span>
    <span class=k>assert</span> <span class=n>some_data</span> <span class=o>==</span> <span class=mi>42</span>
</code></pre></div> <p>The <code>@pytest.fixture()</code> decorator is used to tell pytest that a function is a fixture.When you include the fixture name in the parameter list of a test function,pytest knows to run it before running the test. Fixtures can do work, and can also return data to the test function.</p> <p>The test test_some_data() has the name of the fixture, some_data, as a parameter.pytest will see this and look for a fixture with this name. Naming is significant in pytest. pytest will look in the module of the test for a fixture of that name.</p> <h3 id=sharing-fixtures-through-conftestpy>Sharing fixtures through conftest.py<a class=headerlink href=#sharing-fixtures-through-conftestpy title="Permanent link">&para;</a></h3> <p>You can put fixtures into individual test files, but to share fixtures among multiple test files, you need to use a <code>conftest.py</code> file somewhere centrally located for all of the tests. Additionally you can have <code>conftest.py</code> files in subdirectories of the top <code>tests</code> directory. If you do, fixtures defined in these lower level <code>conftest.py</code> files will be available to tests in that directory and subdirectories.</p> <p>Although <code>conftest.py</code> is a Python module, it should not be imported by test files. The file gets read by pytest, and is considered a local <em>plugin</em>.</p> <h3 id=specifying-fixture-scope>Specifying fixture scope<a class=headerlink href=#specifying-fixture-scope title="Permanent link">&para;</a></h3> <p>Fixtures include an optional parameter called scope, which controls how often a fixture gets set up and torn down. The scope parameter to <code>@pytest.fixture()</code> can have the values of function, class, module, or session.</p> <p>Here’s a rundown of each scope value:</p> <ul> <li><code>scope='function'</code>: Run once per test function. The setup portion is run before each test using the fixture. The teardown portion is run after each test using the fixture. This is the default scope used when no scope parameter is specified.</li> <li><code>scope='class'</code>: Run once per test class, regardless of how many test methods are in the class.</li> <li><code>scope='module'</code>: Run once per module, regardless of how many test functions or methods or other fixtures in the module use it.</li> <li><code>scope='session'</code> Run once per session. All test methods and functions using a fixture of session scope share one setup and teardown call.</li> </ul> <h3 id=builtin-fixtures>Builtin Fixtures<a class=headerlink href=#builtin-fixtures title="Permanent link">&para;</a></h3> <h4 id=the-tmpdir-fixture><a href=https://docs.pytest.org/en/stable/tmpdir.html>The tmpdir fixture</a><a class=headerlink href=#the-tmpdir-fixture title="Permanent link">&para;</a></h4> <p>You can use the <code>tmpdir</code> fixture which will provide a temporary directory unique to the test invocation, created in the base temporary directory.</p> <p><code>tmpdir</code> is a <code>py.path.local</code> object which offers <code>os.path</code> methods and more. Here is an example test usage:</p> <div class="admonition note"> <p class=admonition-title>File: test_tmpdir.py</p> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>test_create_file</span><span class=p>(</span><span class=n>tmpdir</span><span class=p>):</span>
    <span class=n>p</span> <span class=o>=</span> <span class=n>tmpdir</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=s2>&quot;sub&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=s2>&quot;hello.txt&quot;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s2>&quot;content&quot;</span><span class=p>)</span>
    <span class=k>assert</span> <span class=n>p</span><span class=o>.</span><span class=n>read</span><span class=p>()</span> <span class=o>==</span> <span class=s2>&quot;content&quot;</span>
    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>tmpdir</span><span class=o>.</span><span class=n>listdir</span><span class=p>())</span> <span class=o>==</span> <span class=mi>1</span>
    <span class=k>assert</span> <span class=mi>0</span>
</code></pre></div> </div> <p>The <code>tmpdir</code> fixture has a scope of <code>function</code> so you can't make a session directory. Instead use the <code>tmpdir_factory</code> fixture.</p> <div class=highlight><pre><span></span><code><span class=nd>@pytest</span><span class=o>.</span><span class=n>fixture</span><span class=p>(</span><span class=n>scope</span><span class=o>=</span><span class=s2>&quot;session&quot;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>image_file</span><span class=p>(</span><span class=n>tmpdir_factory</span><span class=p>):</span>
    <span class=n>img</span> <span class=o>=</span> <span class=n>compute_expensive_image</span><span class=p>()</span>
    <span class=n>fn</span> <span class=o>=</span> <span class=n>tmpdir_factory</span><span class=o>.</span><span class=n>mktemp</span><span class=p>(</span><span class=s2>&quot;data&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=s2>&quot;img.png&quot;</span><span class=p>)</span>
    <span class=n>img</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>fn</span><span class=p>))</span>
    <span class=k>return</span> <span class=n>fn</span>


<span class=k>def</span> <span class=nf>test_histogram</span><span class=p>(</span><span class=n>image_file</span><span class=p>):</span>
    <span class=n>img</span> <span class=o>=</span> <span class=n>load_image</span><span class=p>(</span><span class=n>image_file</span><span class=p>)</span>
    <span class=c1># compute and test histogram</span>
</code></pre></div> <h4 id=the-caplog-fixture><a href=https://docs.pytest.org/en/stable/logging.html#caplog-fixture>The caplog fixture</a><a class=headerlink href=#the-caplog-fixture title="Permanent link">&para;</a></h4> <p>pytest captures log messages of level WARNING or above automatically and displays them in their own section for each failed test in the same manner as captured stdout and stderr.</p> <p>You can change the default logging level in the pytest configuration</p> <div class="admonition note"> <p class=admonition-title>File: pytest.ini</p> <div class=highlight><pre><span></span><code><span class=k>[pytest]</span>

<span class=na>log_level</span> <span class=o>=</span> <span class=s>debug</span>
</code></pre></div> </div> <p>All the logs sent to the logger during the test run are made available on the fixture in the form of both the <code>logging.LogRecord</code> instances and the final log text. This is useful for when you want to assert on the contents of a message:</p> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>test_baz</span><span class=p>(</span><span class=n>caplog</span><span class=p>):</span>
    <span class=n>func_under_test</span><span class=p>()</span>
    <span class=k>for</span> <span class=n>record</span> <span class=ow>in</span> <span class=n>caplog</span><span class=o>.</span><span class=n>records</span><span class=p>:</span>
        <span class=k>assert</span> <span class=n>record</span><span class=o>.</span><span class=n>levelname</span> <span class=o>!=</span> <span class=s2>&quot;CRITICAL&quot;</span>
    <span class=k>assert</span> <span class=s2>&quot;wally&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>caplog</span><span class=o>.</span><span class=n>text</span>
</code></pre></div> <p>You can also resort to record_tuples if all you want to do is to ensure that certain messages have been logged under a given logger name with a given severity and message:</p> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>test_foo</span><span class=p>(</span><span class=n>caplog</span><span class=p>):</span>
    <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>()</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;boo </span><span class=si>%s</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;arg&quot;</span><span class=p>)</span>

    <span class=k>assert</span>  <span class=p>(</span><span class=s2>&quot;root&quot;</span><span class=p>,</span> <span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>,</span> <span class=s2>&quot;boo arg&quot;</span><span class=p>)</span> <span class=ow>in</span> <span class=n>caplog</span><span class=o>.</span><span class=n>record_tuples</span>
</code></pre></div> <p>You can call <code>caplog.clear()</code> to reset the captured log records in a test.</p> <p>Inside tests it is possible to change the log level for the captured log messages. This is supported by the caplog fixture:</p> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>test_foo</span><span class=p>(</span><span class=n>caplog</span><span class=p>):</span>
    <span class=n>caplog</span><span class=o>.</span><span class=n>set_level</span><span class=p>(</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>
    <span class=k>pass</span>
</code></pre></div> <h4 id=the-capsys-fixture>The capsys fixture<a class=headerlink href=#the-capsys-fixture title="Permanent link">&para;</a></h4> <p>The <code>capsys</code> builtin fixture provides two bits of functionality: it allows you to retrieve stdout and stderr from some code, and it disables output capture temporarily.</p> <p>Suppose you have a function to print a greeting to stdout:</p> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>greeting</span><span class=p>(</span><span class=n>name</span><span class=p>):</span>
    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Hi, </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</code></pre></div> <p>You can test the output by using <code>capsys</code>.</p> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>test_greeting</span><span class=p>(</span><span class=n>capsys</span><span class=p>):</span>
    <span class=n>greeting</span><span class=p>(</span><span class=s1>&#39;Earthling&#39;</span><span class=p>)</span>
    <span class=n>out</span><span class=p>,</span> <span class=n>err</span> <span class=o>=</span> <span class=n>capsys</span><span class=o>.</span><span class=n>readouterr</span><span class=p>()</span>
    <span class=k>assert</span> <span class=n>out</span> <span class=o>==</span> <span class=s1>&#39;Hi, Earthling</span><span class=se>\n</span><span class=s1>&#39;</span>
    <span class=k>assert</span> <span class=n>err</span> <span class=o>==</span> <span class=s1>&#39;&#39;</span>
</code></pre></div> <p>The return value is whatever has been captured since the beginning of the function, or from the last time it was called.</p> <h3 id=use-a-fixture-more-than-once-in-a-function><a href=https://github.com/pytest-dev/pytest/issues/2703>Use a fixture more than once in a function</a><a class=headerlink href=#use-a-fixture-more-than-once-in-a-function title="Permanent link">&para;</a></h3> <p>One solution is to make your fixture return a factory instead of the resource directly:</p> <div class=highlight><pre><span></span><code><span class=nd>@pytest</span><span class=o>.</span><span class=n>fixture</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s1>&#39;make_user&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>make_user_</span><span class=p>():</span>
    <span class=n>created</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>def</span> <span class=nf>make_user</span><span class=p>():</span>
        <span class=n>u</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>User</span><span class=p>()</span>
        <span class=n>u</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
        <span class=n>created</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>u</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>u</span>

    <span class=k>yield</span> <span class=n>make_user</span>

    <span class=k>for</span> <span class=n>u</span> <span class=ow>in</span> <span class=n>created</span><span class=p>:</span>
        <span class=n>u</span><span class=o>.</span><span class=n>delete</span><span class=p>()</span>

<span class=k>def</span> <span class=nf>test_two_users</span><span class=p>(</span><span class=n>make_user</span><span class=p>):</span>
    <span class=n>user1</span> <span class=o>=</span> <span class=n>make_user</span><span class=p>()</span>
    <span class=n>user2</span> <span class=o>=</span> <span class=n>make_user</span><span class=p>()</span>
    <span class=c1># test them</span>


<span class=c1># you can even have the normal fixture when you only need a single user</span>
<span class=nd>@pytest</span><span class=o>.</span><span class=n>fixture</span>
<span class=k>def</span> <span class=nf>user</span><span class=p>(</span><span class=n>make_user</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>make_user</span><span class=p>()</span>

<span class=k>def</span> <span class=nf>test_one_user</span><span class=p>(</span><span class=n>user</span><span class=p>):</span>
    <span class=c1># test him/her</span>
</code></pre></div> <h2 id=snippets>Snippets<a class=headerlink href=#snippets title="Permanent link">&para;</a></h2> <h3 id=mocking-sysexit><a href=https://medium.com/python-pandemonium/testing-sys-exit-with-pytest-10c6e5f7726f>Mocking sys.exit</a><a class=headerlink href=#mocking-sysexit title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=k>with</span> <span class=n>pytest</span><span class=o>.</span><span class=n>raises</span><span class=p>(</span><span class=ne>SystemExit</span><span class=p>):</span>
    <span class=c1># Code to test</span>
</code></pre></div> <h2 id=pytest-integration-with-vim>pytest integration with Vim<a class=headerlink href=#pytest-integration-with-vim title="Permanent link">&para;</a></h2> <p>Integrating pytest into your Vim workflow enhances your productivity while writing code, thus making it easier to code using TDD.</p> <p>I use <a href=https://github.com/janko-m/vim-test>Janko-m's Vim-test plugin</a> (which can be installed through <a href=https://github.com/VundleVim/Vundle.vim>Vundle</a>) with the following configuration.</p> <div class=highlight><pre><span></span><code>nmap <span class=p>&lt;</span><span class=k>silent</span><span class=p>&gt;</span> <span class=k>t</span> :TestNearest<span class=p>&lt;</span>CR<span class=p>&gt;</span>
nmap <span class=p>&lt;</span><span class=k>silent</span><span class=p>&gt;</span> <span class=p>&lt;</span>leader<span class=p>&gt;</span><span class=k>t</span> :TestSuite tests/unit<span class=p>&lt;</span>CR<span class=p>&gt;</span>
nmap <span class=p>&lt;</span><span class=k>silent</span><span class=p>&gt;</span> <span class=p>&lt;</span>leader<span class=p>&gt;</span><span class=k>i</span> :TestSuite tests/integration<span class=p>&lt;</span>CR<span class=p>&gt;</span>
nmap <span class=p>&lt;</span><span class=k>silent</span><span class=p>&gt;</span> <span class=p>&lt;</span>leader<span class=p>&gt;</span>T :TestFile<span class=p>&lt;</span>CR<span class=p>&gt;</span>

<span class=k>let</span> test#python#runner <span class=p>=</span> <span class=s1>&#39;pytest&#39;</span>
<span class=k>let</span> test#strategy <span class=p>=</span> <span class=s2>&quot;neovim&quot;</span>
</code></pre></div> <p>I often open Vim with a vertical split (<code>:vs</code>), in the left window I have the tests and in the right the code. Whenever I want to run a single test I press <code>t</code> when the cursor is inside that test. If you need to make changes in the code, you can press <code>t</code> again while the cursor is at the code you are testing and it will run the last test.</p> <p>Once the unit test has passed, I run the whole unit tests with <code>;t</code> (as <code>;</code> is my <code>&lt;leader&gt;</code>). And finally I use <code>;i</code> to run the integration tests.</p> <p>Finally, if the test suite is huge, I use <code>;T</code> to run only the tests of a single file.</p> <h2 id=reference>Reference<a class=headerlink href=#reference title="Permanent link">&para;</a></h2> <ul> <li>Book <a href=https://www.oreilly.com/library/view/python-testing-with/9781680502848/ >Python Testing with pytest by Brian Okken</a>.</li> <li> <p><a href=https://docs.pytest.org/en/latest/ >Docs</a></p> </li> <li> <p><a href=https://github.com/janko-m/vim-test>Vim-test plugin</a></p> </li> </ul> <hr> <div class=md-source-date> <small> Last update: <span class=timeago datetime=1598879334000 locale=en></span> </small> </div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../data_classes/ title="Data Classes" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Previous </span> Data Classes </span> </div> </a> <a href=../../javascript/javascript/ title=Javascript class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Next </span> Javascript </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> powered by <a href=https://www.mkdocs.org target=_blank rel=noopener>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../../assets/fonts/font-awesome.css> <a href=https://github.com/lyz-code target=_blank rel=noopener title=github class="md-footer-social__link fa fa-github"></a> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/application.c33a9706.js></script> <script>app.initialize({version:"1.1",url:{base:"../../.."}})</script> <script src=https://cdnjs.cloudflare.com/ajax/libs/timeago.js/4.0.0-beta.2/timeago.min.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/timeago.js/4.0.0-beta.2/timeago.locales.min.js></script> <script>
            const nodes = document.querySelectorAll('.timeago');
            const locale = nodes[0].getAttribute('locale');
            timeago.render(nodes, locale);
          </script> </body> </html>