<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="My personal digital garden"><meta name=author content=Lyz><link href=https://lyz-code.github.io/blue-book/devops/kubernetes/kubernetes_jobs/ rel=canonical><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.2.3, mkdocs-material-8.1.3"><title>Kubernetes jobs - The Blue Book</title><link rel=stylesheet href=../../../assets/stylesheets/main.edf004c2.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.e6a45f82.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../css/timeago.css><link rel=stylesheet href=../../../stylesheets/extra.css><link rel=stylesheet href=../../../stylesheets/links.css><script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=light-blue> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#debugging-job-logs class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> For updates subscribe to the <a href=https://lyz-code.github.io/blue-book/newsletter/0_newsletter_index/ ><strong>RSS feed</strong></a> <img src=/blue-book/img/orange_logo.png height=15 width=15> </div> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="The Blue Book" class="md-header__button md-logo" aria-label="The Blue Book" data-md-component=logo> <img src=../../../img/logo.bmp alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> The Blue Book </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Kubernetes jobs </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=light-blue aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue-grey data-md-color-accent=light-blue aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/lyz-code/blue-book/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> lyz-code/blue-book </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="The Blue Book" class="md-nav__button md-logo" aria-label="The Blue Book" data-md-component=logo> <img src=../../../img/logo.bmp alt=logo> </a> The Blue Book </label> <div class=md-nav__source> <a href=https://github.com/lyz-code/blue-book/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> lyz-code/blue-book </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../projects/projects/ class=md-nav__link> Projects </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Activism <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Activism data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Activism </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_1 type=checkbox id=__nav_3_1> <div class="md-nav__link md-nav__link--index "> <a href=../../../antifascism/ >Antifascism</a> </div> <nav class=md-nav aria-label=Antifascism data-md-level=2> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Antifascism </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../antitransphobia/ class=md-nav__link> Anti-Transphobia </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3 type=checkbox id=__nav_3_3> <div class="md-nav__link md-nav__link--index "> <a href=../../../diversity/ >Diversity, Equity and Inclusion</a> </div> <nav class=md-nav aria-label="Diversity, Equity and Inclusion" data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Diversity, Equity and Inclusion </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4 type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4> Feminism <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Feminism data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Feminism </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../feminism/privileges/ class=md-nav__link> Privileges </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../free_knowledge/ class=md-nav__link> Free Knowledge </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <div class="md-nav__link md-nav__link--index "> <a href=../../../life_management/ >Life Management</a> <label for=__nav_4> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="Life Management" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Life Management </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Health <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Health data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Health </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../sleep/ class=md-nav__link> Sleep </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5_2 type=checkbox id=__nav_5_2> <div class="md-nav__link md-nav__link--index "> <a href=../../../teeth/ >Teeth</a> </div> <nav class=md-nav aria-label=Teeth data-md-level=2> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> Teeth </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../remote_work/ class=md-nav__link> Remote Working </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5_4 type=checkbox id=__nav_5_4> <div class="md-nav__link md-nav__link--index "> <a href=../../../fitness_band/ >Fitness Tracker</a> </div> <nav class=md-nav aria-label="Fitness Tracker" data-md-level=2> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> Fitness Tracker </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> Coding <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Coding data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Coding </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_1 type=checkbox id=__nav_6_1> <label class=md-nav__link for=__nav_6_1> Generic Coding Practices <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Generic Coding Practices" data-md-level=2> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> Generic Coding Practices </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_1_1 type=checkbox id=__nav_6_1_1> <div class="md-nav__link md-nav__link--index "> <a href=../../../versioning/ >Program Versioning</a> <label for=__nav_6_1_1> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="Program Versioning" data-md-level=3> <label class=md-nav__title for=__nav_6_1_1> <span class="md-nav__icon md-icon"></span> Program Versioning </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../changelog/ class=md-nav__link> Keep a Changelog </a> </li> <li class=md-nav__item> <a href=../../../documentation/ class=md-nav__link> Writing good documentation </a> </li> <li class=md-nav__item> <a href=../../../coding/tdd/ class=md-nav__link> TDD </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_2 type=checkbox id=__nav_6_2> <div class="md-nav__link md-nav__link--index "> <a href=../../../python/ >Python</a> <label for=__nav_6_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=Python data-md-level=2> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../coding/json/json/ class=md-nav__link> JSON </a> </li> <li class=md-nav__item> <a href=../../../coding/sql/sql/ class=md-nav__link> SQL </a> </li> <li class=md-nav__item> <a href=../../../sqlite/ class=md-nav__link> SQLite </a> </li> <li class=md-nav__item> <a href=../../../coding/yaml/yaml/ class=md-nav__link> YAML </a> </li> <li class=md-nav__item> <a href=../../../coding/promql/promql/ class=md-nav__link> Promql </a> </li> <li class=md-nav__item> <a href=../../../vuejs/ class=md-nav__link> Vue.js </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_9 type=checkbox id=__nav_6_9> <div class="md-nav__link md-nav__link--index "> <a href=../../../coding/javascript/javascript/ >Javascript</a> </div> <nav class=md-nav aria-label=Javascript data-md-level=2> <label class=md-nav__title for=__nav_6_9> <span class="md-nav__icon md-icon"></span> Javascript </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../coding/react/react/ class=md-nav__link> React </a> </li> <li class=md-nav__item> <a href=../../../issues/ class=md-nav__link> Issues </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7 checked> <div class="md-nav__link md-nav__link--index "> <a href=../../devops/ >DevOps</a> <label for=__nav_7> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=DevOps data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> DevOps </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8> Software Architecture <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Software Architecture" data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Software Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../architecture/solid/ class=md-nav__link> SOLID </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_2 type=checkbox id=__nav_8_2> <div class="md-nav__link md-nav__link--index "> <a href=../../../architecture/domain_driven_design/ >Domain Driven Design</a> <label for=__nav_8_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="Domain Driven Design" data-md-level=2> <label class=md-nav__title for=__nav_8_2> <span class="md-nav__icon md-icon"></span> Domain Driven Design </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../adr/ class=md-nav__link> Architecture Decision Record </a> </li> <li class=md-nav__item> <a href=../../../architecture/database_architecture/ class=md-nav__link> Database Architecture </a> </li> <li class=md-nav__item> <a href=../../../architecture/orm_builder_query_or_raw_sql/ class=md-nav__link> ORM, Query Builder or Raw SQL </a> </li> <li class=md-nav__item> <a href=../../../architecture/microservices/ class=md-nav__link> Microservices </a> </li> <li class=md-nav__item> <a href=../../../architecture/restful_apis/ class=md-nav__link> Restful APIS </a> </li> <li class=md-nav__item> <a href=../../../architecture/redis/ class=md-nav__link> Redis </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9 type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9> Data Analysis <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Data Analysis" data-md-level=1> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Data Analysis </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../data_analysis/recommender_systems/recommender_systems/ class=md-nav__link> Recommender Systems </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_10 type=checkbox id=__nav_10> <label class=md-nav__link for=__nav_10> Operative Systems <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Operative Systems" data-md-level=1> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> Operative Systems </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_10_1 type=checkbox id=__nav_10_1> <label class=md-nav__link for=__nav_10_1> Linux <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Linux data-md-level=2> <label class=md-nav__title for=__nav_10_1> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux_snippets/ class=md-nav__link> Linux Snippets </a> </li> <li class=md-nav__item> <a href=../../../afew/ class=md-nav__link> afew </a> </li> <li class=md-nav__item> <a href=../../../alot/ class=md-nav__link> alot </a> </li> <li class=md-nav__item> <a href=../../../activitywatch/ class=md-nav__link> ActivityWatch </a> </li> <li class=md-nav__item> <a href=../../../beancount/ class=md-nav__link> beancount </a> </li> <li class=md-nav__item> <a href=../../../beets/ class=md-nav__link> Beets </a> </li> <li class=md-nav__item> <a href=../../../linux/brew/ class=md-nav__link> brew </a> </li> <li class=md-nav__item> <a href=../../../docker/ class=md-nav__link> Docker </a> </li> <li class=md-nav__item> <a href=../../../dunst/ class=md-nav__link> dunst </a> </li> <li class=md-nav__item> <a href=../../../self_hosted/dynamicdns/ class=md-nav__link> Dynamic DNS </a> </li> <li class=md-nav__item> <a href=../../../linux/elasticsearch/ class=md-nav__link> elasticsearch </a> </li> <li class=md-nav__item> <a href=../../../linux/fail2ban/ class=md-nav__link> fail2ban </a> </li> <li class=md-nav__item> <a href=../../../gajim/ class=md-nav__link> Gajim </a> </li> <li class=md-nav__item> <a href=../../../gh/ class=md-nav__link> Github cli </a> </li> <li class=md-nav__item> <a href=../../../linux/google_chrome/ class=md-nav__link> google chrome </a> </li> <li class=md-nav__item> <a href=../../../graylog/ class=md-nav__link> Graylog </a> </li> <li class=md-nav__item> <a href=../../../linux/haproxy/ class=md-nav__link> HAProxy </a> </li> <li class=md-nav__item> <a href=../../../docs/linux/hard_drive_health.md class=md-nav__link> Hard drive health </a> </li> <li class=md-nav__item> <a href=../../../husboard/ class=md-nav__link> Hushboard </a> </li> <li class=md-nav__item> <a href=../../../linux/hypothesis/ class=md-nav__link> hypothesis </a> </li> <li class=md-nav__item> <a href=../../../jellyfin/ class=md-nav__link> Jellyfin </a> </li> <li class=md-nav__item> <a href=../../../ffmpeg/ class=md-nav__link> ffmpeg </a> </li> <li class=md-nav__item> <a href=../../../kitty/ class=md-nav__link> Kitty </a> </li> <li class=md-nav__item> <a href=../../../linux/luks/luks/ class=md-nav__link> LUKS </a> </li> <li class=md-nav__item> <a href=../../../mbsync/ class=md-nav__link> mbsync </a> </li> <li class=md-nav__item> <a href=../../../linux/mkdocs/ class=md-nav__link> mkdocs </a> </li> <li class=md-nav__item> <a href=../../../modipy.md class=md-nav__link> Modipy </a> </li> <li class=md-nav__item> <a href=../../../linux/monica/ class=md-nav__link> monica </a> </li> <li class=md-nav__item> <a href=../../../notmuch/ class=md-nav__link> notmuch </a> </li> <li class=md-nav__item> <a href=../../../linux/nodejs/ class=md-nav__link> nodejs </a> </li> <li class=md-nav__item> <a href=../../../oracle_database/ class=md-nav__link> Oracle Database </a> </li> <li class=md-nav__item> <a href=../../../peek/ class=md-nav__link> Peek </a> </li> <li class=md-nav__item> <a href=../../../linux/rm/ class=md-nav__link> rm </a> </li> <li class=md-nav__item> <a href=../../../linux/syncthing/ class=md-nav__link> Syncthing </a> </li> <li class=md-nav__item> <a href=../../../tahoe/ class=md-nav__link> Tahoe-LAFS </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_10_1_36 type=checkbox id=__nav_10_1_36> <div class="md-nav__link md-nav__link--index "> <a href=../../../vim/ >Vim</a> <label for=__nav_10_1_36> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=Vim data-md-level=3> <label class=md-nav__title for=__nav_10_1_36> <span class="md-nav__icon md-icon"></span> Vim </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../wake_on_lan/ class=md-nav__link> Wake on Lan </a> </li> <li class=md-nav__item> <a href=../../../linux/wireguard/ class=md-nav__link> Wireguard </a> </li> <li class=md-nav__item> <a href=../../../linux/zfs/ class=md-nav__link> ZFS </a> </li> <li class=md-nav__item> <a href=../../../linux/zip/ class=md-nav__link> zip </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_10_2 type=checkbox id=__nav_10_2> <label class=md-nav__link for=__nav_10_2> Android <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Android data-md-level=2> <label class=md-nav__title for=__nav_10_2> <span class="md-nav__icon md-icon"></span> Android </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cone/ class=md-nav__link> cone </a> </li> <li class=md-nav__item> <a href=../../../gadgetbridge/ class=md-nav__link> GadgetBridge </a> </li> <li class=md-nav__item> <a href=../../../osmand/ class=md-nav__link> OsmAnd </a> </li> <li class=md-nav__item> <a href=../../../signal/ class=md-nav__link> Signal </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_11 type=checkbox id=__nav_11> <label class=md-nav__link for=__nav_11> Arts <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Arts data-md-level=1> <label class=md-nav__title for=__nav_11> <span class="md-nav__icon md-icon"></span> Arts </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_11_1 type=checkbox id=__nav_11_1> <div class="md-nav__link md-nav__link--index "> <a href=../../../writing/writing/ >Writing</a> <label for=__nav_11_1> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=Writing data-md-level=2> <label class=md-nav__title for=__nav_11_1> <span class="md-nav__icon md-icon"></span> Writing </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_11_2 type=checkbox id=__nav_11_2> <div class="md-nav__link md-nav__link--index "> <a href=../../../cooking/ >Cooking</a> </div> <nav class=md-nav aria-label=Cooking data-md-level=2> <label class=md-nav__title for=__nav_11_2> <span class="md-nav__icon md-icon"></span> Cooking </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../pilates/ class=md-nav__link> Pilates </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_11_4 type=checkbox id=__nav_11_4> <label class=md-nav__link for=__nav_11_4> Dancing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Dancing data-md-level=2> <label class=md-nav__title for=__nav_11_4> <span class="md-nav__icon md-icon"></span> Dancing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../dancing/rave_dances/ class=md-nav__link> Rave Dances </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_11_4_2 type=checkbox id=__nav_11_4_2> <label class=md-nav__link for=__nav_11_4_2> Shuffle <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Shuffle data-md-level=3> <label class=md-nav__title for=__nav_11_4_2> <span class="md-nav__icon md-icon"></span> Shuffle </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../dancing/shuffle_basics/ class=md-nav__link> Basics </a> </li> <li class=md-nav__item> <a href=../../../dancing/shuffle_kicks/ class=md-nav__link> Kicks </a> </li> <li class=md-nav__item> <a href=../../../dancing/shuffle_spins/ class=md-nav__link> Spins </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../dancing/cutting_shapes_basics/ class=md-nav__link> Cutting Shapes </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../meditation/ class=md-nav__link> Meditation </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_11_6 type=checkbox id=__nav_11_6> <label class=md-nav__link for=__nav_11_6> Video Gaming <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Video Gaming" data-md-level=2> <label class=md-nav__title for=__nav_11_6> <span class="md-nav__icon md-icon"></span> Video Gaming </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_11_6_1 type=checkbox id=__nav_11_6_1> <label class=md-nav__link for=__nav_11_6_1> The Battle for Wesnoth <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="The Battle for Wesnoth" data-md-level=3> <label class=md-nav__title for=__nav_11_6_1> <span class="md-nav__icon md-icon"></span> The Battle for Wesnoth </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../wesnoth/ class=md-nav__link> The Battle for Wesnoth </a> </li> <li class=md-nav__item> <a href=../../../wesnoth_loyalist/ class=md-nav__link> Loyalist </a> </li> <li class=md-nav__item> <a href=../../../wesnoth_rebels/ class=md-nav__link> Rebels </a> </li> <li class=md-nav__item> <a href=../../../wesnoth_northerners/ class=md-nav__link> Northeners </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_11_7 type=checkbox id=__nav_11_7> <label class=md-nav__link for=__nav_11_7> Board Gaming <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Board Gaming" data-md-level=2> <label class=md-nav__title for=__nav_11_7> <span class="md-nav__icon md-icon"></span> Board Gaming </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../regicide/ class=md-nav__link> Regicide </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_11_8 type=checkbox id=__nav_11_8> <div class="md-nav__link md-nav__link--index "> <a href=../../../drawing/drawing/ >Drawing</a> </div> <nav class=md-nav aria-label=Drawing data-md-level=2> <label class=md-nav__title for=__nav_11_8> <span class="md-nav__icon md-icon"></span> Drawing </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../origami/ class=md-nav__link> Origami </a> </li> <li class=md-nav__item> <a href=../../../fun/ class=md-nav__link> Fun </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_12 type=checkbox id=__nav_12> <label class=md-nav__link for=__nav_12> Psychology <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Psychology data-md-level=1> <label class=md-nav__title for=__nav_12> <span class="md-nav__icon md-icon"></span> Psychology </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../psychology/the_xy_problem/ class=md-nav__link> The XY Problem </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_13 type=checkbox id=__nav_13> <label class=md-nav__link for=__nav_13> Botany <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Botany data-md-level=1> <label class=md-nav__title for=__nav_13> <span class="md-nav__icon md-icon"></span> Botany </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../botany/trees/ class=md-nav__link> Trees </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../emojis/ class=md-nav__link> Emojis </a> </li> <li class=md-nav__item> <a href=../../../contact/ class=md-nav__link> Contact </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_16 type=checkbox id=__nav_16> <div class="md-nav__link md-nav__link--index "> <a href=../../../newsletter/0_newsletter_index/ >Newsletters</a> <label for=__nav_16> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=Newsletters data-md-level=1> <label class=md-nav__title for=__nav_16> <span class="md-nav__icon md-icon"></span> Newsletters </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#debugging-job-logs class=md-nav__link> Debugging job logs </a> <nav class=md-nav aria-label="Debugging job logs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#rerunning-failed-jobs class=md-nav__link> Rerunning failed jobs </a> </li> <li class=md-nav__item> <a href=#manually-creating-a-job-from-a-cronjob class=md-nav__link> Manually creating a job from a cronjob </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#monitorization-of-cronjobs class=md-nav__link> Monitorization of cronjobs </a> <nav class=md-nav aria-label="Monitorization of cronjobs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#building-our-alert class=md-nav__link> Building our alert </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/lyz-code/blue-book/edit/master/docs/devops/kubernetes/kubernetes_jobs.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1>Jobs</h1> <p><a href=https://kubernetes.io/docs/concepts/workloads/controllers/job/ >Kubernetes jobs</a> creates one or more Pods and ensures that a specified number of them successfully terminate. As pods successfully complete, the Job tracks the successful completions. When a specified number of successful completions is reached, the task (ie, Job) is complete. Deleting a Job will clean up the Pods it created.</p> <p><a href=https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs>Cronjobs</a> creates Jobs on a repeating schedule.</p> <p>This example CronJob manifest prints the current time and a hello message every minute:</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">batch/v1beta1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">CronJob</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">hello</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>schedule</span><span class=p>:</span> <span class=s>&quot;*/1</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*&quot;</span>
  <span class=nt>jobTemplate</span><span class=p>:</span>
    <span class=nt>spec</span><span class=p>:</span>
      <span class=nt>template</span><span class=p>:</span>
        <span class=nt>spec</span><span class=p>:</span>
          <span class=nt>containers</span><span class=p>:</span>
          <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">hello</span>
            <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">busybox</span>
            <span class=nt>args</span><span class=p>:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/bin/sh</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">-c</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">date; echo Hello from the Kubernetes cluster</span>
          <span class=nt>restartPolicy</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">OnFailure</span>
</code></pre></div> <p>To deploy cronjobs you can use the <a href=https://github.com/bambash/helm-cronjobs>bambash helm chart</a>.</p> <p>Check <a href=../../kubectl/kubectl_commands/#jobs-and-cronjobs>the kubectl commands to interact with jobs</a>.</p> <h2 id=debugging-job-logs>Debugging job logs<a class=headerlink href=#debugging-job-logs title="Permanent link">⚑</a></h2> <p>To obtain the logs of a completed or failed job, you need to:</p> <ul> <li>Locate the cronjob you want to debug: <code>kubectl get cronjobs -n cronjobs</code>.</li> <li>Locate the associated job: <code>kubectl get jobs -n cronjobs</code>.</li> <li>Locate the associated pod: <code>kubectl get pods -n cronjobs</code>.</li> </ul> <p>If the pod still exists, you can execute <code>kubectl logs -n cronjobs {{ pod_name }}</code>. If the pod doesn't exist anymore, you need to search the pod in your log centralizer solution.</p> <h3 id=rerunning-failed-jobs><a href=https://serverfault.com/questions/809632/is-it-possible-to-rerun-kubernetes-job>Rerunning failed jobs</a><a class=headerlink href=#rerunning-failed-jobs title="Permanent link">⚑</a></h3> <p>If you have a job that has failed after the 6 default retries, it will show up in your monitorization forever, to fix it, you can manually trigger the job yourself with:</p> <div class=highlight><pre><span></span><code>kubectl get job <span class=s2>&quot;your-job&quot;</span> -o json <span class=se>\</span>
    <span class=p>|</span> jq <span class=s1>&#39;del(.spec.selector)&#39;</span> <span class=se>\</span>
    <span class=p>|</span> jq <span class=s1>&#39;del(.spec.template.metadata.labels)&#39;</span> <span class=se>\</span>
    <span class=p>|</span> kubectl replace --force -f -
</code></pre></div> <h3 id=manually-creating-a-job-from-a-cronjob><a href=https://github.com/kubernetes/kubernetes/issues/47538>Manually creating a job from a cronjob</a><a class=headerlink href=#manually-creating-a-job-from-a-cronjob title="Permanent link">⚑</a></h3> <div class=highlight><pre><span></span><code>kubectl create job <span class=o>{{</span> job_name <span class=o>}}</span> -n <span class=o>{{</span> namespace <span class=o>}}</span> <span class=se>\</span>
    --from<span class=o>=</span>cronjobs/<span class=o>{{</span> cronjob_name<span class=o>}}</span>
</code></pre></div> <h2 id=monitorization-of-cronjobs><a href=https://medium.com/@tristan_96324/prometheus-k8s-cronjob-alerts-94bee7b90511>Monitorization of cronjobs</a><a class=headerlink href=#monitorization-of-cronjobs title="Permanent link">⚑</a></h2> <p>Alerting of traditional Unix cronjobs meant sending an email if the job failed. Most job scheduling systems that have followed have provided the same experience, Kubernetes does not. One approach to alerting jobs is to use the Prometheus push gateway, allowing us to push richer metrics than the success/failure status. This approach has it’s downsides; we have to update the code for our jobs, we also have to explicitly configure a push gateway location and update it if it changes (a burden alleviated by the pull based metrics for long lived workloads). You can use tools such as Sentry, but it will also require changes to the jobs.</p> <p>Jobs are powerful things allowing us to implement several different workflows, the combination of options can be overwhelming compared to a traditional Unix cron job. This variety makes it difficult to establish one simple rule for alerting failed jobs. Things get easier if we restrict ourselves to a subset of possible options. We will focus on non-concurrent jobs.</p> <p>The relationship between cronjobs and jobs makes the task ahead difficult. To make our life easier we will put one requirement on the jobs we create, they will have to include a label that associates them with the original cronjob.</p> <p>Below we present an example of our ideal cronjob (which matches what the <a href=https://github.com/bambash/helm-cronjobs>helm chart</a> deploys):</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">batch/v1beta1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">CronJob</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">our-task</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>schedule</span><span class=p>:</span> <span class=s>&quot;*/5</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*&quot;</span>
  <span class=nt>successfulJobsHistoryLimit</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class=nt>concurrencyPolicy</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Forbid</span>
  <span class=nt>jobTemplate</span><span class=p>:</span>
    <span class=nt>metadata</span><span class=p>:</span>
      <span class=nt>labels</span><span class=p>:</span>
        <span class=nt>cron</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">our-task</span> <span class=c1># &lt;-- match created jobs with the cronjob</span>
    <span class=nt>spec</span><span class=p>:</span>
      <span class=nt>backoffLimit</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
      <span class=nt>template</span><span class=p>:</span>
        <span class=nt>metadata</span><span class=p>:</span>
          <span class=nt>labels</span><span class=p>:</span>
            <span class=nt>cronjob</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">our-task</span>
        <span class=nt>spec</span><span class=p>:</span>
          <span class=nt>containers</span><span class=p>:</span>
          <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">our-task</span>
            <span class=nt>command</span><span class=p>:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/user/bin/false</span>
            <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
          <span class=nt>restartPolicy</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Never</span>
</code></pre></div> <h3 id=building-our-alert>Building our alert<a class=headerlink href=#building-our-alert title="Permanent link">⚑</a></h3> <p>We are also going to need some metrics to get us started. K8s does not provide us any by default, but fortunately <code>kube-state-metrics</code> is installed with the <a href=../../prometheus/prometheus_operator/ >Prometheus operator</a> chart, so we have the following metrics:</p> <div class=highlight><pre><span></span><code>kube_cronjob_labels{
  cronjob=&quot;our-task&quot;,
  namespace=&quot;default&quot;} 1
kube_job_created{
  job=&quot;our-task-1520165700&quot;,
  namespace=&quot;default&quot;} 1.520165707e+09
kube_job_failed{
  condition=&quot;false&quot;,
  job=&quot;our-task-1520165700&quot;,
  namespace=&quot;default&quot;} 0
kube_job_failed{
  condition=&quot;true&quot;,
  job=&quot;our-task-1520165700&quot;,
  namespace=&quot;default&quot;} 1
kube_job_labels{
  job=&quot;our-task-1520165700&quot;,
  label_cron=&quot;our-task&quot;,
  namespace=&quot;default&quot;} 1
</code></pre></div> <p>This shows the primary set of metrics we will be using to construct our alert. What is not shown above is the status of the cronjob. The big challenge with K8s cronjob alerting is that cronjobs themselves do not possess any status information, beyond the last time the cronjob created a job. The status information only exists on the job that the cronjob creates.</p> <p>In order to determine if our cronjob is failing, our first order of business is to find which jobs we should be looking at. A K8s cronjob creates new job objects and keeps a number of them around to help us debug the runs of our jobs. We have to be determine which job corresponds to the last run of our cronjob. If we have added the cron label to the jobs as above, we can find the last run time of the jobs for a given cronjob as follows:</p> <div class=highlight><pre><span></span><code><span class=k>max</span><span class=o>(</span><span class=w></span>
<span class=w>  </span><span class=nv>kube_job_status_start_time</span><span class=w></span>
<span class=w>  </span><span class=o>*</span><span class=w> </span><span class=nv>ON</span><span class=o>(</span><span class=nv>job_name</span><span class=o>)</span><span class=w> </span><span class=nv>GROUP_RIGHT</span><span class=o>()</span><span class=w></span>
<span class=w>  </span><span class=nv>kube_job_labels</span><span class=p>{</span><span class=nl>label_cron</span><span class=o>!=</span><span class=p>&quot;&quot;}</span><span class=w></span>
<span class=o>)</span><span class=w> </span><span class=nv>BY</span><span class=w> </span><span class=o>(</span><span class=nv>job_name</span><span class=p>,</span><span class=w> </span><span class=nv>label_cron</span><span class=o>)</span><span class=w></span>
</code></pre></div> <p>This query demonstrates an important technique when working with <code>kube-state-metrics</code>. For each API object it exported data on, it exports a time series including all the labels for that object. These time series have a value of 1. As such we can join the set of labels for an object onto the metrics about that object by multiplication.</p> <p>Depending on how your Prometheus instance is configured, the value of the job label on your metrics will likely be <code>kube-state-metrics</code>. <code>kube-state-metrics</code> adds a job label itself with the name of the job object. Prometheus resolves this collision of label names by including the raw metric’s label as an <code>job_name</code> label.</p> <p>Since we are querying the start time of jobs, and there should only ever be one job with a given name. You may wonder why we need the max aggregation. Manually plugging the query into Prometheus may convince you that it is unnecessary. Consider though that you may have multiple instances of <code>kube-state-metrics</code> running for redundancy. Using max ensures our query is valid even if we have multiple instances of kube-state-metrics running. Issues of duplicate metrics are common when constructing production recording rules and alerts.</p> <p>We can find the start time of the most recent job for a given cronjob by finding the maximum of all job start times as follows:</p> <div class=highlight><pre><span></span><code><span class=k>max</span><span class=o>(</span><span class=w></span>
<span class=w>  </span><span class=nv>kube_job_status_start_time</span><span class=w></span>
<span class=w>  </span><span class=o>*</span><span class=w> </span><span class=nv>ON</span><span class=o>(</span><span class=nv>job_name</span><span class=o>)</span><span class=w> </span><span class=nv>GROUP_RIGHT</span><span class=o>()</span><span class=w></span>
<span class=w>  </span><span class=nv>kube_job_labels</span><span class=p>{</span><span class=nl>label_cron</span><span class=o>!=</span><span class=p>&quot;&quot;}</span><span class=w></span>
<span class=o>)</span><span class=w> </span><span class=nv>BY</span><span class=w> </span><span class=o>(</span><span class=nv>label_cron</span><span class=o>)</span><span class=w></span>
</code></pre></div> <p>The only difference between this and the previous query is in the labels used for the aggregation. Now that we have the start time of each job, and the start time of the most recent job, we can do a simple equality match to find the start time of the most recent job for a given cronjob. We will create a metric for this:</p> <div class=highlight><pre><span></span><code><span class=o>-</span><span class=w> </span><span class=nv>record</span><span class=err>:</span><span class=w> </span><span class=nv>job_cronjob</span><span class=err>:</span><span class=nv>kube_job_status_start_time</span><span class=err>:</span><span class=k>max</span><span class=w></span>
<span class=w>  </span><span class=nv>expr</span><span class=err>:</span><span class=w> </span><span class=err>|</span><span class=w></span>
<span class=w>      </span><span class=k>sum</span><span class=w> </span><span class=k>without</span><span class=w> </span><span class=o>(</span><span class=nv>label_cron</span><span class=p>,</span><span class=w> </span><span class=nv>job_name</span><span class=o>)</span><span class=w> </span><span class=o>(</span><span class=w></span>
<span class=w>          </span><span class=kr>label_replace</span><span class=o>(</span><span class=w></span>
<span class=w>              </span><span class=kr>label_replace</span><span class=o>(</span><span class=w></span>
<span class=w>                  </span><span class=k>max</span><span class=o>(</span><span class=w></span>
<span class=w>                      </span><span class=nv>kube_job_status_start_time</span><span class=w></span>
<span class=w>                      </span><span class=o>*</span><span class=w> </span><span class=nv>ON</span><span class=o>(</span><span class=nv>job_name</span><span class=o>)</span><span class=w> </span><span class=nv>GROUP_RIGHT</span><span class=o>()</span><span class=w></span>
<span class=w>                      </span><span class=nv>kube_job_labels</span><span class=p>{</span><span class=nl>label_cron</span><span class=o>!=</span><span class=p>&quot;&quot;}</span><span class=w></span>
<span class=w>                  </span><span class=o>)</span><span class=w> </span><span class=nv>BY</span><span class=w> </span><span class=o>(</span><span class=nv>job_name</span><span class=p>,</span><span class=w> </span><span class=nv>label_cron</span><span class=o>)</span><span class=w></span>

<span class=w>                  </span><span class=o>==</span><span class=w> </span><span class=nv>ON</span><span class=o>(</span><span class=nv>label_cron</span><span class=o>)</span><span class=w> </span><span class=nv>GROUP_LEFT</span><span class=o>()</span><span class=w></span>

<span class=w>                  </span><span class=k>max</span><span class=o>(</span><span class=w></span>
<span class=w>                      </span><span class=nv>kube_job_status_start_time</span><span class=w></span>
<span class=w>                      </span><span class=o>*</span><span class=w> </span><span class=nv>ON</span><span class=o>(</span><span class=nv>job_name</span><span class=o>)</span><span class=w> </span><span class=nv>GROUP_RIGHT</span><span class=o>()</span><span class=w></span>
<span class=w>                      </span><span class=nv>kube_job_labels</span><span class=p>{</span><span class=nl>label_cron</span><span class=o>!=</span><span class=p>&quot;&quot;}</span><span class=w></span>
<span class=w>                  </span><span class=o>)</span><span class=w> </span><span class=nv>BY</span><span class=w> </span><span class=o>(</span><span class=nv>label_cron</span><span class=o>)</span><span class=p>,</span><span class=w></span>
<span class=w>                  </span><span class=p>&quot;</span><span class=s>job</span><span class=p>&quot;,</span><span class=w> </span><span class=p>&quot;</span><span class=s>$1</span><span class=p>&quot;,</span><span class=w> </span><span class=p>&quot;</span><span class=s>job_name</span><span class=p>&quot;,</span><span class=w> </span><span class=p>&quot;</span><span class=s>(.+)</span><span class=p>&quot;</span><span class=w></span>
<span class=w>              </span><span class=o>)</span><span class=p>,</span><span class=w></span>
<span class=w>                  </span><span class=p>&quot;</span><span class=s>cronjob</span><span class=p>&quot;,</span><span class=w> </span><span class=p>&quot;</span><span class=s>$1</span><span class=p>&quot;,</span><span class=w> </span><span class=p>&quot;</span><span class=s>label_cron</span><span class=p>&quot;,</span><span class=w> </span><span class=p>&quot;</span><span class=s>(.+)</span><span class=p>&quot;</span><span class=w></span>
<span class=w>          </span><span class=o>)</span><span class=w></span>
<span class=w>      </span><span class=o>)</span><span class=w></span>
</code></pre></div> <p>We have also taken the opportunity to adjust the labels to be a little more aesthetically pleasing. By copying <code>job_name</code> to <code>job</code>, <code>label_cron</code> to <code>cronjob</code> and removing <code>job_name</code> and <code>label_cron</code>. Now that we have the most recently started job for a given cronjob, we can find which, if any, have failed attempts:</p> <div class=highlight><pre><span></span><code><span class=o>-</span><span class=w> </span><span class=nv>record</span><span class=err>:</span><span class=w> </span><span class=nv>job_cronjob</span><span class=err>:</span><span class=nv>kube_job_status_failed</span><span class=err>:</span><span class=k>sum</span><span class=w></span>
<span class=w>    </span><span class=nv>expr</span><span class=err>:</span><span class=w> </span><span class=err>|</span><span class=w></span>
<span class=w>      </span><span class=k>sum</span><span class=w> </span><span class=k>without</span><span class=w> </span><span class=o>(</span><span class=nv>label_cron</span><span class=p>,</span><span class=w> </span><span class=nv>job_name</span><span class=o>)</span><span class=w> </span><span class=o>(</span><span class=w></span>
<span class=w>          </span><span class=kr>clamp_max</span><span class=o>(</span><span class=w></span>
<span class=w>              </span><span class=nv>job_cronjob</span><span class=err>:</span><span class=nv>kube_job_status_start_time</span><span class=err>:</span><span class=k>max</span><span class=p>,</span><span class=w></span>
<span class=w>              </span><span class=mi>1</span><span class=w></span>
<span class=w>          </span><span class=o>)</span><span class=w></span>

<span class=w>          </span><span class=o>*</span><span class=w> </span><span class=nv>ON</span><span class=o>(</span><span class=nv>job</span><span class=o>)</span><span class=w> </span><span class=nv>GROUP_LEFT</span><span class=o>()</span><span class=w></span>

<span class=w>          </span><span class=kr>label_replace</span><span class=o>(</span><span class=w></span>
<span class=w>              </span><span class=kr>label_replace</span><span class=o>(</span><span class=w></span>
<span class=w>                  </span><span class=o>(</span><span class=w></span>
<span class=w>                    </span><span class=nv>kube_job_status_failed</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=ow>and</span><span class=w></span>
<span class=w>                    </span><span class=nv>kube_job_status_succeeded</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=w></span>
<span class=w>                  </span><span class=o>)</span><span class=p>,</span><span class=w></span>
<span class=w>                  </span><span class=p>&quot;</span><span class=s>job</span><span class=p>&quot;,</span><span class=w> </span><span class=p>&quot;</span><span class=s>$1</span><span class=p>&quot;,</span><span class=w> </span><span class=p>&quot;</span><span class=s>job_name</span><span class=p>&quot;,</span><span class=w> </span><span class=p>&quot;</span><span class=s>(.+)</span><span class=p>&quot;</span><span class=w></span>
<span class=w>              </span><span class=o>)</span><span class=p>,</span><span class=w></span>
<span class=w>              </span><span class=p>&quot;</span><span class=s>cronjob</span><span class=p>&quot;,</span><span class=w> </span><span class=p>&quot;</span><span class=s>$1</span><span class=p>&quot;,</span><span class=w> </span><span class=p>&quot;</span><span class=s>label_cron</span><span class=p>&quot;,</span><span class=w> </span><span class=p>&quot;</span><span class=s>(.+)</span><span class=p>&quot;</span><span class=w></span>
<span class=w>          </span><span class=o>)</span><span class=w></span>
<span class=w>      </span><span class=o>)</span><span class=w></span>
</code></pre></div> <p>The initial <code>clamp_max</code> clause is used to transform our start times metric into a set of time series to perform label matching to filter another set of metrics. Multiplication by 1 (or addition of 0), is a useful means of filter and merging time series and it is well worth taking the time to understand the technique.</p> <p>We get those cronjobs that have a failed job and no successful ones with the query:</p> <div class=highlight><pre><span></span><code><span class=o>(</span><span class=w></span>
<span class=w>    </span><span class=nv>kube_job_status_failed</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=ow>and</span><span class=w></span>
<span class=w>    </span><span class=nv>kube_job_status_succeeded</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=w></span>
<span class=o>)</span><span class=w></span>
</code></pre></div> <p>The <code>kube_job_status_succeeded == 0</code> it's important, otherwise once a job has a failed instance, it doesn't matter if there's a posterior one that succeeded, we're going to keep on receiving the alert that it failed.</p> <p>We adjust the labels on the previous query to match our start time metric so ensure the labels have the same meaning as those on our <code>job_cronjob:kube_job_status_start_time:max</code> metric. The label matching on the multiplication will then perform our filtering. We now have a metric containing the set of most recently failed jobs, labeled by their parent cronjob, so we can now construct the alert:</p> <div class=highlight><pre><span></span><code><span class=o>-</span><span class=w> </span><span class=nv>alert</span><span class=err>:</span><span class=w> </span><span class=nv>CronJobStatusFailed</span><span class=w></span>
<span class=w>    </span><span class=nv>expr</span><span class=err>:</span><span class=w> </span><span class=nv>job_cronjob</span><span class=err>:</span><span class=nv>kube_job_status_failed</span><span class=err>:</span><span class=k>sum</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=w></span>
<span class=w>    </span><span class=nv>for</span><span class=err>:</span><span class=w> </span><span class=s>1m</span><span class=w></span>
<span class=w>    </span><span class=nv>annotations</span><span class=err>:</span><span class=w></span>
<span class=w>      </span><span class=nv>description</span><span class=err>:</span><span class=w> </span><span class=p>&#39;</span><span class=s>{{ $labels.cronjob }} last run has failed {{ $value }} times.</span><span class=p>&#39;</span><span class=w></span>
</code></pre></div> <p>We use the <code>kube_cronjob_labels</code> here to merge in labels from the original cronjob.</p> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2021-11-17T22:21:10+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2021-11-17</span> </small> </div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../kubernetes_operators/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Operators" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Operators </div> </div> </a> <a href=../../kubectl/kubectl/ class="md-footer__link md-footer__link--next" aria-label="Next: Kubectl" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Kubectl </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/lyz-code target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> <a href=https://lyz-code.github.io/blue-book/newsletter/0_newsletter_index target=_blank rel=noopener title=lyz-code.github.io class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.instant", "navigation.top", "content.code.annotate"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.0bbba5b5.min.js"}</script> <script src=../../../assets/javascripts/bundle.e1a181d9.min.js></script> <script src=../../../js/timeago.min.js></script> <script src=../../../js/timeago_mkdocs_material.js></script> </body> </html>