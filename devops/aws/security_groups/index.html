<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="My second brain"><link href=https://lyz-code.github.io/blue-book/devops/aws/security_groups/ rel=canonical><meta name=author content=Lyz><link rel="shortcut icon" href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-6.0.2"><title>Security groups - The Blue Book</title><link rel=stylesheet href=../../../assets/stylesheets/main.38780c08.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.3f72e892.min.css><meta name=theme-color content=#546d78><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel=stylesheet href=../../../stylesheets/extra.css><link rel=stylesheet href=../../../stylesheets/links.css><style>
        .git-revision-date-localized-plugin-iso_date { display: none }
        @media print {
           .git-revision-date-localized-plugin-iso_date { display: inline } 
           .git-revision-date-localized-plugin-timeago { display: none } 
        }
        </style></head> <body dir=ltr data-md-color-scheme data-md-color-primary=blue-grey data-md-color-accent=light-blue> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#best-practices class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=https://lyz-code.github.io/blue-book title="The Blue Book" class="md-header-nav__button md-logo" aria-label="The Blue Book"> <img src=../../../img/logo.bmp alt=logo> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> The Blue Book </span> <span class="md-header-nav__topic md-ellipsis"> Security groups </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/lyz-code/blue-book/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> lyz-code/blue-book </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://lyz-code.github.io/blue-book title="The Blue Book" class="md-nav__button md-logo" aria-label="The Blue Book"> <img src=../../../img/logo.bmp alt=logo> </a> The Blue Book </label> <div class=md-nav__source> <a href=https://github.com/lyz-code/blue-book/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> lyz-code/blue-book </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Meta <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Meta data-md-level=1> <label class=md-nav__title for=nav-2> <span class="md-nav__icon md-icon"></span> Meta </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../meta/meta/ class=md-nav__link> Meta </a> </li> <li class=md-nav__item> <a href=../../../projects/projects/ class=md-nav__link> Projects </a> </li> <li class=md-nav__item> <a href=../../../wish_list/ class=md-nav__link> Wish list </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3 type=checkbox id=nav-3 checked> <label class=md-nav__link for=nav-3> DevOps <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=DevOps data-md-level=1> <label class=md-nav__title for=nav-3> <span class="md-nav__icon md-icon"></span> DevOps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../devops/ class=md-nav__link> DevOps </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-2 type=checkbox id=nav-3-2> <label class=md-nav__link for=nav-3-2> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kubernetes data-md-level=2> <label class=md-nav__title for=nav-3-2> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/kubernetes/ class=md-nav__link> Kubernetes </a> </li> <li class=md-nav__item> <a href=../../kubernetes/kubernetes_architecture/ class=md-nav__link> Architecture </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-2-3 type=checkbox id=nav-3-2-3> <label class=md-nav__link for=nav-3-2-3> Resources <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Resources data-md-level=3> <label class=md-nav__title for=nav-3-2-3> <span class="md-nav__icon md-icon"></span> Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/kubernetes_namespaces/ class=md-nav__link> Namespaces </a> </li> <li class=md-nav__item> <a href=../../kubernetes/kubernetes_pods/ class=md-nav__link> Pods </a> </li> <li class=md-nav__item> <a href=../../kubernetes/kubernetes_replicasets/ class=md-nav__link> ReplicaSets </a> </li> <li class=md-nav__item> <a href=../../kubernetes/kubernetes_deployments/ class=md-nav__link> Deployments </a> </li> <li class=md-nav__item> <a href=../../kubernetes/kubernetes_hpa/ class=md-nav__link> Horizontal Pod Autoscaling </a> </li> <li class=md-nav__item> <a href=../../kubernetes/kubernetes_volumes/ class=md-nav__link> Volumes </a> </li> <li class=md-nav__item> <a href=../../kubernetes/kubernetes_services/ class=md-nav__link> Services </a> </li> <li class=md-nav__item> <a href=../../kubernetes/kubernetes_labels/ class=md-nav__link> Labels </a> </li> <li class=md-nav__item> <a href=../../kubernetes/kubernetes_annotations/ class=md-nav__link> Annotations </a> </li> <li class=md-nav__item> <a href=../../kubernetes/kubernetes_ingress/ class=md-nav__link> Ingress </a> </li> <li class=md-nav__item> <a href=../../kubernetes/kubernetes_operators/ class=md-nav__link> Operators </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-2-4 type=checkbox id=nav-3-2-4> <label class=md-nav__link for=nav-3-2-4> Kubectl <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kubectl data-md-level=3> <label class=md-nav__title for=nav-3-2-4> <span class="md-nav__icon md-icon"></span> Kubectl </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubectl/kubectl/ class=md-nav__link> Kubectl </a> </li> <li class=md-nav__item> <a href=../../kubectl/kubectl_installation/ class=md-nav__link> Kubectl Installation </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-2-5 type=checkbox id=nav-3-2-5> <label class=md-nav__link for=nav-3-2-5> Additional Components <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Additional Components" data-md-level=3> <label class=md-nav__title for=nav-3-2-5> <span class="md-nav__icon md-icon"></span> Additional Components </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/kubernetes_metric_server/ class=md-nav__link> Metrics Server </a> </li> <li class=md-nav__item> <a href=../../kubernetes/kubernetes_ingress_controller/ class=md-nav__link> Ingress Controller </a> </li> <li class=md-nav__item> <a href=../../kubernetes/kubernetes_external_dns/ class=md-nav__link> External DNS </a> </li> <li class=md-nav__item> <a href=../../kubernetes/kubernetes_cluster_autoscaler/ class=md-nav__link> Cluster Autoscaler </a> </li> <li class=md-nav__item> <a href=../../kubernetes/kubernetes_dashboard/ class=md-nav__link> Dashboard </a> </li> <li class=md-nav__item> <a href=../../kubernetes/kubernetes_storage_driver/ class=md-nav__link> Storage Driver </a> </li> <li class=md-nav__item> <a href=../../kubernetes/kubernetes_vertical_pod_autoscaler/ class=md-nav__link> Vertical Pod Autoscaler </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../kubernetes/kubernetes_networking/ class=md-nav__link> Networking </a> </li> <li class=md-nav__item> <a href=../../kubernetes/kubernetes_tools/ class=md-nav__link> Tools </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-3 type=checkbox id=nav-3-3> <label class=md-nav__link for=nav-3-3> Helm <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Helm data-md-level=2> <label class=md-nav__title for=nav-3-3> <span class="md-nav__icon md-icon"></span> Helm </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../helm/helm/ class=md-nav__link> Helm </a> </li> <li class=md-nav__item> <a href=../../helm/helm_installation/ class=md-nav__link> Helm Installation </a> </li> <li class=md-nav__item> <a href=../../helm/helm_commands/ class=md-nav__link> Helm Commands </a> </li> <li class=md-nav__item> <a href=../../helm/helm_secrets/ class=md-nav__link> Helm Secrets </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../helmfile/ class=md-nav__link> Helmfile </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-5 type=checkbox id=nav-3-5> <label class=md-nav__link for=nav-3-5> Prometheus <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Prometheus data-md-level=2> <label class=md-nav__title for=nav-3-5> <span class="md-nav__icon md-icon"></span> Prometheus </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../prometheus/prometheus/ class=md-nav__link> Prometheus </a> </li> <li class=md-nav__item> <a href=../../prometheus/prometheus_architecture/ class=md-nav__link> Architecture </a> </li> <li class=md-nav__item> <a href=../../prometheus/prometheus_operator/ class=md-nav__link> Prometheus Operator </a> </li> <li class=md-nav__item> <a href=../../prometheus/prometheus_installation/ class=md-nav__link> Prometheus Install </a> </li> <li class=md-nav__item> <a href=../../prometheus/alertmanager/ class=md-nav__link> AlertManager </a> </li> <li class=md-nav__item> <a href=../../prometheus/blackbox_exporter/ class=md-nav__link> Blackbox Exporter </a> </li> <li class=md-nav__item> <a href=../../prometheus/node_exporter/ class=md-nav__link> Node Exporter </a> </li> <li class=md-nav__item> <a href=../../prometheus/prometheus_troubleshooting/ class=md-nav__link> Prometheus Troubleshooting </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-6 type=checkbox id=nav-3-6> <label class=md-nav__link for=nav-3-6> Linux <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Linux data-md-level=2> <label class=md-nav__title for=nav-3-6> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/brew/ class=md-nav__link> brew </a> </li> <li class=md-nav__item> <a href=../../../linux/cookiecutter/ class=md-nav__link> cookiecutter </a> </li> <li class=md-nav__item> <a href=../../../linux/elasticsearch/ class=md-nav__link> elasticsearch </a> </li> <li class=md-nav__item> <a href=../../../linux/fail2ban/ class=md-nav__link> fail2ban </a> </li> <li class=md-nav__item> <a href=../../../linux/google_chrome/ class=md-nav__link> google chrome </a> </li> <li class=md-nav__item> <a href=../../../linux/hypothesis/ class=md-nav__link> hypothesis </a> </li> <li class=md-nav__item> <a href=../../../linux/luks/luks/ class=md-nav__link> LUKS </a> </li> <li class=md-nav__item> <a href=../../../linux/mkdocs/ class=md-nav__link> mkdocs </a> </li> <li class=md-nav__item> <a href=../../../linux/monica/ class=md-nav__link> monica </a> </li> <li class=md-nav__item> <a href=../../../linux/linux_miscellaneous/ class=md-nav__link> Miscellaneous Linux Commands </a> </li> <li class=md-nav__item> <a href=../../../linux/nodejs/ class=md-nav__link> nodejs </a> </li> <li class=md-nav__item> <a href=../../../linux/rm/ class=md-nav__link> rm </a> </li> <li class=md-nav__item> <a href=../../../linux/syncthing/ class=md-nav__link> Syncthing </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-6-14 type=checkbox id=nav-3-6-14> <label class=md-nav__link for=nav-3-6-14> Vim <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Vim data-md-level=3> <label class=md-nav__title for=nav-3-6-14> <span class="md-nav__icon md-icon"></span> Vim </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/vim/vim_plugins/ class=md-nav__link> Vim Plugins </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../linux/wireguard/ class=md-nav__link> Wireguard </a> </li> <li class=md-nav__item> <a href=../../../linux/zip/ class=md-nav__link> zip </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-7 type=checkbox id=nav-3-7 checked> <label class=md-nav__link for=nav-3-7> AWS <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=AWS data-md-level=2> <label class=md-nav__title for=nav-3-7> <span class="md-nav__icon md-icon"></span> AWS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../aws/ class=md-nav__link> AWS </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Security groups workflow <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Security groups workflow </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#best-practices class=md-nav__link> Best practices </a> </li> <li class=md-nav__item> <a href=#naming-convention class=md-nav__link> Naming convention </a> <nav class=md-nav aria-label="Naming convention"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#default-security-groups class=md-nav__link> Default security groups </a> </li> <li class=md-nav__item> <a href=#naming-security-groups class=md-nav__link> Naming security groups </a> </li> <li class=md-nav__item> <a href=#ingress-security-groups class=md-nav__link> Ingress security groups </a> </li> <li class=md-nav__item> <a href=#egress-security-groups class=md-nav__link> Egress security groups </a> </li> <li class=md-nav__item> <a href=#instance-security-group-definition class=md-nav__link> Instance security group definition </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../eks/ class=md-nav__link> EKS </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-7-4 type=checkbox id=nav-3-7-4> <label class=md-nav__link for=nav-3-7-4> IAM <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=IAM data-md-level=3> <label class=md-nav__title for=nav-3-7-4> <span class="md-nav__icon md-icon"></span> IAM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../iam/iam/ class=md-nav__link> IAM </a> </li> <li class=md-nav__item> <a href=../iam/iam_commands/ class=md-nav__link> IAM Commands </a> </li> <li class=md-nav__item> <a href=../iam/iam_debug/ class=md-nav__link> IAM Debugging </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../s3/ class=md-nav__link> S3 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-8 type=checkbox id=nav-3-8> <label class=md-nav__link for=nav-3-8> API Management <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="API Management" data-md-level=2> <label class=md-nav__title for=nav-3-8> <span class="md-nav__icon md-icon"></span> API Management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../api_management/ class=md-nav__link> API Management </a> </li> <li class=md-nav__item> <a href=../../kong/kong/ class=md-nav__link> Kong </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> Coding <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Coding data-md-level=1> <label class=md-nav__title for=nav-4> <span class="md-nav__icon md-icon"></span> Coding </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../coding/tdd/ class=md-nav__link> TDD </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-2 type=checkbox id=nav-4-2> <label class=md-nav__link for=nav-4-2> Python <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python data-md-level=2> <label class=md-nav__title for=nav-4-2> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-2-1 type=checkbox id=nav-4-2-1> <label class=md-nav__link for=nav-4-2-1> Project Template <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Project Template" data-md-level=3> <label class=md-nav__title for=nav-4-2-1> <span class="md-nav__icon md-icon"></span> Project Template </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../coding/python/python_project_template/ class=md-nav__link> Project Template </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-2-1-2 type=checkbox id=nav-4-2-1-2> <label class=md-nav__link for=nav-4-2-1-2> Command-line Project Template <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Command-line Project Template" data-md-level=4> <label class=md-nav__title for=nav-4-2-1-2> <span class="md-nav__icon md-icon"></span> Command-line Project Template </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../coding/python/python_project_template/python_cli_template/ class=md-nav__link> Command-line Project Template </a> </li> <li class=md-nav__item> <a href=../../../coding/python/python_project_template/python_sqlalchemy_without_flask/ class=md-nav__link> Configure SQLAlchemy for projects without flask </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../coding/python/python_project_template/python_flask_template/ class=md-nav__link> Flask Project Template </a> </li> <li class=md-nav__item> <a href=../../../coding/python/python_project_template/python_microservices_template/ class=md-nav__link> Microservices Project Template </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-2-1-5 type=checkbox id=nav-4-2-1-5> <label class=md-nav__link for=nav-4-2-1-5> Common configurations <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Common configurations" data-md-level=4> <label class=md-nav__title for=nav-4-2-1-5> <span class="md-nav__icon md-icon"></span> Common configurations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../coding/python/python_project_template/python_docs/ class=md-nav__link> Create the documentation repository </a> </li> <li class=md-nav__item> <a href=../../../coding/python/python_ci/ class=md-nav__link> Continuous integration pipelines </a> </li> <li class=md-nav__item> <a href=../../../coding/python/python_config_yaml/ class=md-nav__link> Load config from YAML </a> </li> <li class=md-nav__item> <a href=../../../coding/python/python_project_template/python_sqlalchemy_mariadb/ class=md-nav__link> Configure SQLAlchemy to use the MariaDB/Mysql backend </a> </li> <li class=md-nav__item> <a href=../../../coding/python/python_project_template/python_docker/ class=md-nav__link> Configure Docker to host the application </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-2-2 type=checkbox id=nav-4-2-2> <label class=md-nav__link for=nav-4-2-2> Libraries <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Libraries data-md-level=3> <label class=md-nav__title for=nav-4-2-2> <span class="md-nav__icon md-icon"></span> Libraries </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../coding/python/alembic/ class=md-nav__link> Alembic </a> </li> <li class=md-nav__item> <a href=../../../coding/python/click/ class=md-nav__link> Click </a> </li> <li class=md-nav__item> <a href=../../../coding/python/deepdiff/ class=md-nav__link> DeepDiff </a> </li> <li class=md-nav__item> <a href=../../../coding/python/factoryboy/ class=md-nav__link> FactoryBoy </a> </li> <li class=md-nav__item> <a href=../../../coding/python/faker/ class=md-nav__link> Faker </a> </li> <li class=md-nav__item> <a href=../../../coding/python/flask/ class=md-nav__link> Flask </a> </li> <li class=md-nav__item> <a href=../../../coding/python/folium/ class=md-nav__link> Folium </a> </li> <li class=md-nav__item> <a href=../../../coding/python/feedparser/ class=md-nav__link> Feedparser </a> </li> <li class=md-nav__item> <a href=../../../coding/python/pandas/ class=md-nav__link> Pandas </a> </li> <li class=md-nav__item> <a href=../../../coding/python/passpy/ class=md-nav__link> Passpy </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-2-2-11 type=checkbox id=nav-4-2-2-11> <label class=md-nav__link for=nav-4-2-2-11> Pydantic <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Pydantic data-md-level=4> <label class=md-nav__title for=nav-4-2-2-11> <span class="md-nav__icon md-icon"></span> Pydantic </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../coding/python/pydantic/ class=md-nav__link> Pydantic </a> </li> <li class=md-nav__item> <a href=../../../coding/python/pydantic_types/ class=md-nav__link> Pydantic Field Types </a> </li> <li class=md-nav__item> <a href=../../../coding/python/pydantic_validators/ class=md-nav__link> Pydantic Validators </a> </li> <li class=md-nav__item> <a href=../../../coding/python/pydantic_exporting/ class=md-nav__link> Pydantic Exporting Models </a> </li> <li class=md-nav__item> <a href=../../../coding/python/pydantic_functions/ class=md-nav__link> Pydantic Validating Functions </a> </li> <li class=md-nav__item> <a href=../../../coding/python/pydantic_mypy_plugin/ class=md-nav__link> Pydantic Mypy Plugin </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../coding/python/pypika/ class=md-nav__link> Pypika </a> </li> <li class=md-nav__item> <a href=../../../coding/python/plotly/ class=md-nav__link> Plotly </a> </li> <li class=md-nav__item> <a href=../../../coding/python/ruamel_yaml/ class=md-nav__link> Ruamel YAML </a> </li> <li class=md-nav__item> <a href=../../../coding/python/sqlalchemy/ class=md-nav__link> SQLAlchemy </a> </li> <li class=md-nav__item> <a href=../../../coding/python/redis-py/ class=md-nav__link> Redis-py </a> </li> <li class=md-nav__item> <a href=../../../coding/python/requests_mock/ class=md-nav__link> Requests-mock </a> </li> <li class=md-nav__item> <a href=../../../coding/python/rq/ class=md-nav__link> Rq </a> </li> <li class=md-nav__item> <a href=../../../coding/python/sh/ class=md-nav__link> sh </a> </li> <li class=md-nav__item> <a href=../../../coding/python/tinydb/ class=md-nav__link> TinyDB </a> </li> <li class=md-nav__item> <a href=../../../coding/python/yoyo/ class=md-nav__link> Yoyo </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../coding/python/type_hints/ class=md-nav__link> Type Hints </a> </li> <li class=md-nav__item> <a href=../../../coding/python/python_code_styling/ class=md-nav__link> Code Styling </a> </li> <li class=md-nav__item> <a href=../../../coding/python/python_anti_patterns/ class=md-nav__link> Anti-Patterns </a> </li> <li class=md-nav__item> <a href=../../../coding/python/data_classes/ class=md-nav__link> Data Classes </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-2-7 type=checkbox id=nav-4-2-7> <label class=md-nav__link for=nav-4-2-7> Pytest <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Pytest data-md-level=3> <label class=md-nav__title for=nav-4-2-7> <span class="md-nav__icon md-icon"></span> Pytest </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../coding/python/pytest/ class=md-nav__link> Pytest </a> </li> <li class=md-nav__item> <a href=../../../coding/python/pytest_parametrized_testing/ class=md-nav__link> Parametrized testing </a> </li> <li class=md-nav__item> <a href=../../../coding/python/pytest_cases/ class=md-nav__link> Pytest-cases </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../coding/javascript/javascript/ class=md-nav__link> Javascript </a> </li> <li class=md-nav__item> <a href=../../../coding/json/json/ class=md-nav__link> JSON </a> </li> <li class=md-nav__item> <a href=../../../coding/react/react/ class=md-nav__link> React </a> </li> <li class=md-nav__item> <a href=../../../coding/sql/sql/ class=md-nav__link> SQL </a> </li> <li class=md-nav__item> <a href=../../../coding/yaml/yaml/ class=md-nav__link> YAML </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Software Architecture <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Software Architecture" data-md-level=1> <label class=md-nav__title for=nav-5> <span class="md-nav__icon md-icon"></span> Software Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../architecture/solid/ class=md-nav__link> SOLID </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> Domain Driven Design <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Domain Driven Design" data-md-level=2> <label class=md-nav__title for=nav-5-2> <span class="md-nav__icon md-icon"></span> Domain Driven Design </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../architecture/domain_driven_design/ class=md-nav__link> Domain Driven Design </a> </li> <li class=md-nav__item> <a href=../../../architecture/repository_pattern/ class=md-nav__link> Repository Pattern </a> </li> <li class=md-nav__item> <a href=../../../architecture/service_layer_pattern/ class=md-nav__link> Service Layer Pattern </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../architecture/database_architecture/ class=md-nav__link> Database Architecture </a> </li> <li class=md-nav__item> <a href=../../../architecture/orm_builder_query_or_raw_sql/ class=md-nav__link> ORM, Query Builder or Raw SQL </a> </li> <li class=md-nav__item> <a href=../../../architecture/microservices/ class=md-nav__link> Microservices </a> </li> <li class=md-nav__item> <a href=../../../architecture/restful_apis/ class=md-nav__link> Restful APIS </a> </li> <li class=md-nav__item> <a href=../../../architecture/redis/ class=md-nav__link> Redis </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> Data Analysis <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Data Analysis" data-md-level=1> <label class=md-nav__title for=nav-6> <span class="md-nav__icon md-icon"></span> Data Analysis </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-1 type=checkbox id=nav-6-1> <label class=md-nav__link for=nav-6-1> Recommender Systems <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Recommender Systems" data-md-level=2> <label class=md-nav__title for=nav-6-1> <span class="md-nav__icon md-icon"></span> Recommender Systems </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../data_analysis/recommender_systems/recommender_systems/ class=md-nav__link> Recommender Systems </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class=md-nav__link for=nav-7> Life Automation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Life Automation" data-md-level=1> <label class=md-nav__title for=nav-7> <span class="md-nav__icon md-icon"></span> Life Automation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../life_automation/life_automation/ class=md-nav__link> Life Automation </a> </li> <li class=md-nav__item> <a href=../../../life_automation/week_automation/ class=md-nav__link> Week Automation </a> </li> <li class=md-nav__item> <a href=../../../life_automation/relationship_automation/ class=md-nav__link> Relationship Automation </a> </li> <li class=md-nav__item> <a href=../../../life_automation/vim_automation/ class=md-nav__link> Vim Automation </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8 type=checkbox id=nav-8> <label class=md-nav__link for=nav-8> Arts <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Arts data-md-level=1> <label class=md-nav__title for=nav-8> <span class="md-nav__icon md-icon"></span> Arts </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-1 type=checkbox id=nav-8-1> <label class=md-nav__link for=nav-8-1> Writing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Writing data-md-level=2> <label class=md-nav__title for=nav-8-1> <span class="md-nav__icon md-icon"></span> Writing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../writing/orthography/ class=md-nav__link> English Grammar and Ortography </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-2 type=checkbox id=nav-8-2> <label class=md-nav__link for=nav-8-2> Dancing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Dancing data-md-level=2> <label class=md-nav__title for=nav-8-2> <span class="md-nav__icon md-icon"></span> Dancing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../dancing/rave_dances/ class=md-nav__link> Rave Dances </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-2-2 type=checkbox id=nav-8-2-2> <label class=md-nav__link for=nav-8-2-2> Shuffle <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Shuffle data-md-level=3> <label class=md-nav__title for=nav-8-2-2> <span class="md-nav__icon md-icon"></span> Shuffle </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../dancing/shuffle_basics/ class=md-nav__link> Basics </a> </li> <li class=md-nav__item> <a href=../../../dancing/shuffle_kicks/ class=md-nav__link> Kicks </a> </li> <li class=md-nav__item> <a href=../../../dancing/shuffle_spins/ class=md-nav__link> Spins </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../dancing/cutting_shapes_basics/ class=md-nav__link> Cutting Shapes </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-3 type=checkbox id=nav-8-3> <label class=md-nav__link for=nav-8-3> Drawing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Drawing data-md-level=2> <label class=md-nav__title for=nav-8-3> <span class="md-nav__icon md-icon"></span> Drawing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../drawing/drawing/ class=md-nav__link> Drawing </a> </li> <li class=md-nav__item> <a href=../../../drawing/exercise_pool/ class=md-nav__link> Exercise Pool </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9 type=checkbox id=nav-9> <label class=md-nav__link for=nav-9> Psychology <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Psychology data-md-level=1> <label class=md-nav__title for=nav-9> <span class="md-nav__icon md-icon"></span> Psychology </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../psychology/the_xy_problem/ class=md-nav__link> The XY Problem </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10 type=checkbox id=nav-10> <label class=md-nav__link for=nav-10> Botany <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Botany data-md-level=1> <label class=md-nav__title for=nav-10> <span class="md-nav__icon md-icon"></span> Botany </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../botany/trees/ class=md-nav__link> Trees </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../emojis/ class=md-nav__link> Emojis </a> </li> <li class=md-nav__item> <a href=../../../contact/ class=md-nav__link> Contact </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#best-practices class=md-nav__link> Best practices </a> </li> <li class=md-nav__item> <a href=#naming-convention class=md-nav__link> Naming convention </a> <nav class=md-nav aria-label="Naming convention"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#default-security-groups class=md-nav__link> Default security groups </a> </li> <li class=md-nav__item> <a href=#naming-security-groups class=md-nav__link> Naming security groups </a> </li> <li class=md-nav__item> <a href=#ingress-security-groups class=md-nav__link> Ingress security groups </a> </li> <li class=md-nav__item> <a href=#egress-security-groups class=md-nav__link> Egress security groups </a> </li> <li class=md-nav__item> <a href=#instance-security-group-definition class=md-nav__link> Instance security group definition </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/lyz-code/blue-book/edit/master/docs/devops/aws/security_groups.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1>Security groups workflow</h1> <p>Security groups are the AWS way of defining firewall rules between the resources. If not handled properly they can soon become hard to read, which can lead to an insecure infrastructure.</p> <p>It has helped me to use four types of security groups:</p> <ul> <li>Default security groups: Security groups created by AWS per VPC and region, they can't be deleted.</li> <li>Naming security groups: Used to identify an aws resource. They are usually referenced in other security groups.</li> <li>Ingress security groups: Used to define the rules of ingress traffic to the resource.</li> <li>Egress security groups: Used to define the rules of egress traffic to the resource.</li> </ul> <p>But what helped most has been using <a href=https://github.com/lyz-code/clinv>clinv</a> while refactoring all the security groups.</p> <p>With <code>clinv unused</code> I got rid of all the security groups that weren't used by any AWS resource (beware of <a href=https://github.com/lyz-code/clinv/issues/16>#16</a>, <a href=https://github.com/lyz-code/clinv/issues/17>17</a>, <a href=https://github.com/lyz-code/clinv/issues/18>#18</a> and <a href=https://github.com/lyz-code/clinv/issues/19>#19</a>), then used the <code>clinv unassigned security_groups</code> to methodically decide if they were correct and add them to my inventory or if I needed to refactor them.</p> <h2 id=best-practices>Best practices<a class=headerlink href=#best-practices title="Permanent link">&para;</a></h2> <ul> <li>Follow a <a href=#naming-convention>naming convention</a>.</li> <li>Avoid as much as you can the use of CIDRs in the definition of security groups. Instead, use naming security groups as much as you can. This will probably mean that you'll need to create security rules for each service that is going to use the security group. It is cumbersome but from a security point of view we gain traceability.</li> <li>Follow the principle of least privileges. Open the least number of ports required for the service to work.</li> <li>Reuse existing security groups. If there is a security group for web servers that uses port 80, don't create the new service using port 8080.</li> <li>Remove all rules from the default security groups and don't use them.</li> <li>Don't define the rules in the <code>aws_security_group</code> terraform resource. Use <code>aws_security_group_rules</code> for each security group to avoid creation dependency loops.</li> <li>Add descriptions to each security group and security group rule.</li> <li>Avoid using port ranges in the security group rule definitions, as you probably won't need them.</li> </ul> <h2 id=naming-convention>Naming convention<a class=headerlink href=#naming-convention title="Permanent link">&para;</a></h2> <p>A naming convention is required once the number of security groups starts to grow, both to understand them and to be able to search in them.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>It is assumed that terraform is used to create the resources</p> </div> <h3 id=default-security-groups>Default security groups<a class=headerlink href=#default-security-groups title="Permanent link">&para;</a></h3> <p>There are going to be two kinds of default security groups:</p> <ul> <li>VPC default security groups.</li> <li>Region default security groups.</li> </ul> <p>For the first one we'll use:</p> <div class=highlight><pre><span></span><code><span class=kr>resource</span> <span class=s>&quot;aws_default_security_group&quot; &quot;{{ region_id }}_{{ vpc_friendly_identifier }}&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  vpc_id</span> <span class=o>=</span> <span class=s2>&quot;{{ vpc_id }}&quot;</span>
<span class=" -Punctuation">}</span>
</code></pre></div> <p>Where:</p> <ul> <li><code>region_id</code> is the region identifier with underscores, for example <code>us_east_1</code></li> <li><code>vpc_friendly_identifier</code> is a human understandable identifier, such as <code>publicdmz</code>.</li> <li><code>vpc_id</code> is the VPC id such as <code>vpc-xxxxxxxxxxxxxxxxx</code>.</li> </ul> <p>For the second one:</p> <div class=highlight><pre><span></span><code><span class=kr>resource</span> <span class=s>&quot;aws_default_security_group&quot; &quot;{{ region_id }}&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  provider</span> <span class=o>=</span> <span class=err>aws</span><span class=p>.</span><span class=" -Punctuation">{{</span> <span class=err>region_id</span> <span class=" -Punctuation">}}</span>
<span class=" -Punctuation">}</span>

<span class=err>Where</span> <span class=err>the</span> <span class=kr>provider</span><span class=err> must be configured in the `terraform_config</span><span class=p>.</span><span class=err>tf` file</span><span class=p>,</span><span class=err> for</span>
<span class=err>example:</span>

<span class=err>```</span><span class=kd>terraform</span>
<span class=kr>provider</span> <span class=s>&quot;aws&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  alias</span>  <span class=o>=</span> <span class=s2>&quot;us_west_2&quot;</span>
<span class=na>  region</span> <span class=o>=</span> <span class=s2>&quot;us-west-2&quot;</span>
<span class=" -Punctuation">}</span>
</code></pre></div> <h3 id=naming-security-groups>Naming security groups<a class=headerlink href=#naming-security-groups title="Permanent link">&para;</a></h3> <p>For the naming security groups I've created an <a href=https://github.com/SirVer/ultisnips>UltiSnips</a> template.</p> <div class=highlight><pre><span></span><code><span class=err>snippet</span> <span class=err>naming</span> <span class=s2>&quot;naming security group rule&quot;</span> <span class=err>b</span>
<span class=kr>resource</span> <span class=s>&quot;aws_security_group&quot; &quot;${1:resource_name}_${2:resource_type}&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  name</span>        <span class=o>=</span> <span class=s2>&quot;$1-$2&quot;</span>
<span class=na>  description</span> <span class=o>=</span> <span class=s2>&quot;Identify the $1 $2.&quot;</span>
<span class=na>  vpc_id</span>      <span class=o>=</span> <span class=kr>data</span><span class=p>.</span><span class=err>terraform_remote_state</span><span class=p>.</span><span class=err>vpc</span><span class=p>.</span><span class=err>outputs</span><span class=p>.</span><span class=err>vpc_$</span><span class=" -Punctuation">{</span><span class=err>3:vpc</span><span class=" -Punctuation">}</span><span class=err>_id</span>
<span class=na>  tags</span> <span class=o>=</span> <span class=" -Punctuation">{</span>
<span class=na>    Name</span> <span class=o>=</span> <span class=s2>&quot;$1 $2&quot;</span>
  <span class=" -Punctuation">}</span>
<span class=" -Punctuation">}</span>

<span class=kr>output</span> <span class=s>&quot;$1_$2_id&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  value</span> <span class=o>=</span> <span class=err>aws_security_group</span><span class=p>.</span><span class=err>$</span><span class=m>1</span><span class=err>_$</span><span class=m>2</span><span class=p>.</span><span class=err>id</span>
<span class=" -Punctuation">}</span>
<span class=err>$</span><span class=m>0</span>
<span class=err>endsnippet</span>
</code></pre></div> <p>Where:</p> <ul> <li><code>instance_name</code> is a human friendly identifier of the resource that the security group is going to identify, for example <code>gitea</code>, <code>ci</code> or <code>bastion</code>.</li> <li><code>resource_type</code> identifies the type of resource, such as <code>instance</code> for EC2, or <code>load_balancer</code> for ELBs.</li> <li><code>vpc</code>: is a human friendly identifier of the vpc. It has to match the outputs of the vpc resources, as it's going to be also used in the definition of the vpc used by the security group.</li> </ul> <p>Once you've finished defining the security group, move the <code>output</code> resource to the <code>outputs.tf</code> file.</p> <h3 id=ingress-security-groups>Ingress security groups<a class=headerlink href=#ingress-security-groups title="Permanent link">&para;</a></h3> <p>For the ingress security groups I've created another <a href=https://github.com/SirVer/ultisnips>UltiSnips</a> template.</p> <div class=highlight><pre><span></span><code><span class=err>snippet</span> <span class=kd>ingress</span> <span class=s2>&quot;ingress security group rule&quot;</span> <span class=err>b</span>
<span class=kr>resource</span> <span class=s>&quot;aws_security_group&quot; &quot;ingress_${1:protocol}_from_${2:destination}_at_${3:vpc}&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  name</span>        <span class=o>=</span> <span class=s2>&quot;ingress-$1-from-$2-at-$3&quot;</span>
<span class=na>  description</span> <span class=o>=</span> <span class=s2>&quot;Allow the ingress of $1 traffic from the $2 instances at $3&quot;</span>
<span class=na>  vpc_id</span>      <span class=o>=</span> <span class=kr>data</span><span class=p>.</span><span class=err>terraform_remote_state</span><span class=p>.</span><span class=err>vpc</span><span class=p>.</span><span class=err>outputs</span><span class=p>.</span><span class=err>vpc_$3_id</span>
<span class=na>  tags</span> <span class=o>=</span> <span class=" -Punctuation">{</span>
<span class=na>    Name</span> <span class=o>=</span> <span class=s2>&quot;Ingress $1 from $2 at $3&quot;</span>
  <span class=" -Punctuation">}</span>
<span class=" -Punctuation">}</span>

<span class=kr>resource</span> <span class=s>&quot;aws_security_group_rule&quot; &quot;ingress_$1_from_$2_at_$3&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  type</span>              <span class=o>=</span> <span class=s2>&quot;ingress&quot;</span>
<span class=na>  from_port</span>         <span class=o>=</span> <span class=si>${</span><span class=err>4:port</span><span class=si>}</span>
<span class=na>  to_port</span>           <span class=o>=</span> <span class=si>${</span><span class=err>5:$4</span><span class=si>}</span>
<span class=na>  protocol</span>          <span class=o>=</span> <span class=s2>&quot;${6:tcp}&quot;</span>
<span class=na>  security_group_id</span> <span class=o>=</span> <span class=err>aws_security_group</span><span class=p>.</span><span class=err>ingress_$</span><span class=m>1</span><span class=err>_from_$</span><span class=m>2</span><span class=err>_at_$</span><span class=m>3</span><span class=p>.</span><span class=err>id</span>
<span class=na>  source_security_group_id</span> <span class=o>=</span> <span class=err>aws_security_group</span><span class=p>.</span><span class=err>$</span><span class=m>7</span><span class=p>.</span><span class=err>id</span>
<span class=na>  description</span>      <span class=o>=</span> <span class=s2>&quot;Allow the ingress $1 traffic on port $4 from the $2 instances at $3.&quot;</span>
<span class=" -Punctuation">}</span>

<span class=kr>output</span> <span class=s>&quot;ingress_$1_from_$2_at_$3_id&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  value</span> <span class=o>=</span> <span class=err>aws_security_group</span><span class=p>.</span><span class=err>ingress_$</span><span class=m>1</span><span class=err>_from_$</span><span class=m>2</span><span class=err>_at_$</span><span class=m>3</span><span class=p>.</span><span class=err>id</span>
<span class=" -Punctuation">}</span>
<span class=err>$</span><span class=m>0</span>
<span class=err>endsnippet</span>
</code></pre></div> <p>Where:</p> <ul> <li><code>protocol</code> is a human friendly identifier of what kind of traffic the security group is going to allow, for example <code>gitea</code>, <code>ssh</code>, <code>proxy</code> or <code>openvpn</code>.</li> <li><code>destination</code> identifies the resources that are going to use the security group, for example <code>drone_instance</code>, <code>ldap_instance</code> or <code>everywhere</code>.</li> <li><code>vpc</code>: is a human friendly identifier of the vpc. It has to match the outputs of the vpc resources, as it's going to be also used in the definition of the vpc used by the security group.</li> <li><code>port</code> is the port we are going to open.</li> <li><code>$6</code> we assume that the <code>to_port</code> is the same as <code>from_port</code>.</li> <li> <p><code>$7</code> ID of the naming security group that will have access to the particular security group rule. If you need to use CIDRs for the rule definition, change that line for the following:</p> <div class=highlight><pre><span></span><code><span class=na>cidr_blocks</span>       <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;{{ cidr }}&quot;</span><span class=p>]</span>
</code></pre></div> </li> </ul> <p>Once you've finished defining the security group, move the <code>output</code> resource to the <code>outputs.tf</code> file.</p> <h3 id=egress-security-groups>Egress security groups<a class=headerlink href=#egress-security-groups title="Permanent link">&para;</a></h3> <p>For the egress security groups I've created another <a href=https://github.com/SirVer/ultisnips>UltiSnips</a> template.</p> <div class=highlight><pre><span></span><code><span class=err>snippet</span> <span class=kd>egress</span> <span class=s2>&quot;egress security group rule&quot;</span> <span class=err>b</span>
<span class=kr>resource</span> <span class=s>&quot;aws_security_group&quot; &quot;egress_${1:protocol}_to_${2:destination}_from_${3:vpc}&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  name</span>        <span class=o>=</span> <span class=s2>&quot;egress-$1-to-$2-from-$3&quot;</span>
<span class=na>  description</span> <span class=o>=</span> <span class=s2>&quot;Allow the egress of $1 traffic to the $2 instances at $3&quot;</span>
<span class=na>  vpc_id</span>      <span class=o>=</span> <span class=kr>data</span><span class=p>.</span><span class=err>terraform_remote_state</span><span class=p>.</span><span class=err>vpc</span><span class=p>.</span><span class=err>outputs</span><span class=p>.</span><span class=err>vpc_$3_id</span>
<span class=na>  tags</span> <span class=o>=</span> <span class=" -Punctuation">{</span>
<span class=na>    Name</span> <span class=o>=</span> <span class=s2>&quot;Egress $1 to $2 at $3&quot;</span>
  <span class=" -Punctuation">}</span>
<span class=" -Punctuation">}</span>

<span class=kr>resource</span> <span class=s>&quot;aws_security_group_rule&quot; &quot;egress_$1_to_$2_from_$3&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  type</span>              <span class=o>=</span> <span class=s2>&quot;egress&quot;</span>
<span class=na>  from_port</span>         <span class=o>=</span> <span class=si>${</span><span class=err>4:port</span><span class=si>}</span>
<span class=na>  to_port</span>           <span class=o>=</span> <span class=si>${</span><span class=err>5:$4</span><span class=si>}</span>
<span class=na>  protocol</span>          <span class=o>=</span> <span class=s2>&quot;${6:tcp}&quot;</span>
<span class=na>  security_group_id</span> <span class=o>=</span> <span class=err>aws_security_group</span><span class=p>.</span><span class=err>egress_$</span><span class=m>1</span><span class=err>_to_$</span><span class=m>2</span><span class=err>_from_$</span><span class=m>3</span><span class=p>.</span><span class=err>id</span>
<span class=na>  source_security_group_id</span> <span class=o>=</span> <span class=err>aws_security_group</span><span class=p>.</span><span class=err>$</span><span class=m>7</span><span class=p>.</span><span class=err>id</span>
<span class=na>  description</span>      <span class=o>=</span> <span class=s2>&quot;Allow the egress of $1 traffic on port $4 to the $2 instances at $3.&quot;</span>
<span class=" -Punctuation">}</span>

<span class=kr>output</span> <span class=s>&quot;egress_$1_to_$2_from_$3_id&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  value</span> <span class=o>=</span> <span class=err>aws_security_group</span><span class=p>.</span><span class=err>egress_$</span><span class=m>1</span><span class=err>_to_$</span><span class=m>2</span><span class=err>_from_$</span><span class=m>3</span><span class=p>.</span><span class=err>id</span>
<span class=" -Punctuation">}</span>
<span class=err>$</span><span class=m>0</span>
<span class=err>endsnippet</span>
</code></pre></div> <p>Where:</p> <ul> <li><code>protocol</code> is a human friendly identifier of what kind of traffic the security group is going to allow, for example <code>gitea</code>, <code>ssh</code>, <code>proxy</code> or <code>openvpn</code>.</li> <li><code>destination</code> identifies the resources that are going to be accessed by the security group, for example <code>drone_instance</code>, <code>ldap_instance</code> or <code>everywhere</code>.</li> <li><code>vpc</code>: is a human friendly identifier of the vpc. It has to match the outputs of the vpc resources, as it's going to be also used in the definition of the vpc used by the security group.</li> <li><code>port</code> is the port we are going to open.</li> <li><code>$6</code> we assume that the <code>to_port</code> is the same as <code>from_port</code>.</li> <li> <p><code>$7</code> ID of the naming security group that will be accessed by the particular security group rule. If you need to use CIDRs for the rule definition, change that line for the following:</p> <div class=highlight><pre><span></span><code><span class=na>cidr_blocks</span>       <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;{{ cidr }}&quot;</span><span class=p>]</span>
</code></pre></div> </li> </ul> <p>Once you've finished defining the security group, move the <code>output</code> resource to the <code>outputs.tf</code> file.</p> <h3 id=instance-security-group-definition>Instance security group definition<a class=headerlink href=#instance-security-group-definition title="Permanent link">&para;</a></h3> <p>When defining the security groups in the <code>aws_instance</code> resources, define them in this order:</p> <ul> <li>Naming security groups.</li> <li>Ingress security groups.</li> <li>Egress security groups.</li> </ul> <p>For example</p> <div class=highlight><pre><span></span><code><span class=kr>resource</span> <span class=s>&quot;aws_instance&quot; &quot;gitea_production&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>  ami</span>               <span class=o>=</span> <span class=p>...</span>
<span class=na>  availability_zone</span> <span class=o>=</span> <span class=p>...</span>
<span class=na>  subnet_id</span>         <span class=o>=</span> <span class=p>...</span>
<span class=na>  vpc_security_group_ids</span> <span class=o>=</span> <span class=p>[</span>
    <span class=kr>data</span><span class=p>.</span><span class=err>terraform_remote_state</span><span class=p>.</span><span class=err>security_groups</span><span class=p>.</span><span class=err>outputs</span><span class=p>.</span><span class=err>gitea_instance_id</span><span class=p>,</span>
    <span class=kr>data</span><span class=p>.</span><span class=err>terraform_remote_state</span><span class=p>.</span><span class=err>security_groups</span><span class=p>.</span><span class=err>outputs</span><span class=p>.</span><span class=err>ingress_http_from_gitea_loadbalancer_at_publicdmz_id</span><span class=p>,</span>
    <span class=kr>data</span><span class=p>.</span><span class=err>terraform_remote_state</span><span class=p>.</span><span class=err>security_groups</span><span class=p>.</span><span class=err>outputs</span><span class=p>.</span><span class=err>ingress_http_from_monitoring_at_privatedmz_id</span><span class=p>,</span>
    <span class=kr>data</span><span class=p>.</span><span class=err>terraform_remote_state</span><span class=p>.</span><span class=err>security_groups</span><span class=p>.</span><span class=err>outputs</span><span class=p>.</span><span class=err>ingress_administration_from_bastion_at_connectiondmz_id</span><span class=p>,</span>
    <span class=kr>data</span><span class=p>.</span><span class=err>terraform_remote_state</span><span class=p>.</span><span class=err>security_groups</span><span class=p>.</span><span class=err>outputs</span><span class=p>.</span><span class=err>egress_ldap_to_ldap_instance_from_publicdmz_id</span><span class=p>,</span>
    <span class=kr>data</span><span class=p>.</span><span class=err>terraform_remote_state</span><span class=p>.</span><span class=err>security_groups</span><span class=p>.</span><span class=err>outputs</span><span class=p>.</span><span class=err>egress_https_to_debian_repositories_from_publicdmz_id</span><span class=p>,</span>
  <span class=p>]</span>
</code></pre></div> <hr> <div class=md-source-date> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2020-04-29T17:44:39+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2020-04-29</span> </small> </div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../aws/ class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> AWS </div> </div> </a> <a href=../eks/ class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> EKS </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/lyz-code target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/vendor.77e55a48.min.js></script> <script src=../../../assets/javascripts/bundle.9554a270.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script> <script>
        app = initialize({
          base: "../../..",
          features: ['navigation.instant'],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> <script src=https://cdnjs.cloudflare.com/ajax/libs/timeago.js/4.0.0-beta.2/timeago.min.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/timeago.js/4.0.0-beta.2/timeago.locales.min.js></script> <script>
          if (
            typeof app !== "undefined" && 
            typeof app.document$ !== "undefined"
            ) {
            app.document$.subscribe(function() {
                var nodes = document.querySelectorAll('.timeago');
                var locale = nodes[0].getAttribute('locale');
                timeago.render(nodes, locale);
            })
         } else {
             var nodes = document.querySelectorAll('.timeago');
             var locale = nodes[0].getAttribute('locale');
             timeago.render(nodes, locale);
         }
          </script> </body> </html>